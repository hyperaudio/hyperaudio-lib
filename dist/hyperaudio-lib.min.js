/*! hyperaudio-lib v0.6.2 ~ (c) 2012-2014 Hyperaudio Inc. <hello@hyperaud.io> (http://hyperaud.io) http://hyperaud.io/licensing/ ~ Built: 4th December 2014 19:17:00 */
!function(a,b){function c(a){u.put.call(this,a)}function d(a){this.parent=a,this.byStart=[{start:-1,end:-1}],this.byEnd=[{start:-1,end:-1}],this.animating=[],this.startIndex=0,this.endIndex=0,this.previousUpdateTime=-1,this.count=1}function e(a,b,c){return a[b]&&a[b]===c}function f(a,b){var c={};for(var d in a)l.call(b,d)&&l.call(a,d)&&(c[d]=a[d]);return c}function g(a,b){return function(){if(v.plugin.debug)return a.apply(this,arguments);try{return a.apply(this,arguments)}catch(c){v.plugin.errors.push({plugin:b,thrown:c,source:a.toString()}),this.emit("pluginerror",v.plugin.errors)}}}if(b.addEventListener){var h=Array.prototype,i=Object.prototype,j=h.forEach,k=h.slice,l=i.hasOwnProperty,m=i.toString,n=a.Popcorn,o=[],p=!1,q=!1,r={events:{hash:{},apis:{}}},s=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,16)}}(),t=function(a){return Object.keys?Object.keys(a):function(a){var b,c=[];for(b in a)l.call(a,b)&&c.push(b);return c}(a)},u={put:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}},v=function(a,b){return new v.p.init(a,b||null)};v.version="@VERSION",v.isSupported=!0,v.instances=[],v.p=v.prototype={init:function(a,c){var e,f,g=this;{if("function"!=typeof a){if("string"==typeof a)try{e=b.querySelector(a)}catch(h){throw new Error("Popcorn.js Error: Invalid media element selector: "+a)}if(this.media=e||a,f=this.media.nodeName&&this.media.nodeName.toLowerCase()||"video",this[f]=this.media,this.options=v.extend({},c)||{},this.id=this.options.id||v.guid(f),v.byId(this.id))throw new Error("Popcorn.js Error: Cannot use duplicate ID ("+this.id+")");this.isDestroyed=!1,this.data={running:{cue:[]},timeUpdate:v.nop,disabled:{},events:{},hooks:{},history:[],state:{volume:this.media.volume},trackRefs:{},trackEvents:new d(this)},v.instances.push(this);var i=function(){g.media.currentTime<0&&(g.media.currentTime=0),g.media.removeEventListener("loadedmetadata",i,!1);var a,b,c,d,e,f;a=g.media.duration,b=a!=a?Number.MAX_VALUE:a+1,v.addTrackEvent(g,{start:b,end:b}),g.isDestroyed||(g.data.durationChange=function(){var a=g.media.duration,b=a+1,c=g.data.trackEvents.byStart,d=g.data.trackEvents.byEnd;c.pop(),d.pop();for(var e=d.length-1;e>0;e--)d[e].end>a&&g.removeTrackEvent(d[e]._id);for(var f=0;f<c.length;f++)c[f].end>a&&g.removeTrackEvent(c[f]._id);g.data.trackEvents.byEnd.push({start:b,end:b}),g.data.trackEvents.byStart.push({start:b,end:b})},g.media.addEventListener("durationchange",g.data.durationChange,!1)),g.options.frameAnimation?(g.data.timeUpdate=function(){v.timeUpdate(g,{}),v.forEach(v.manifest,function(a,b){if(c=g.data.running[b]){e=c.length;for(var h=0;e>h;h++)d=c[h],f=d._natives,f&&f.frame&&f.frame.call(g,{},d,g.currentTime())}}),g.emit("timeupdate"),!g.isDestroyed&&s(g.data.timeUpdate)},!g.isDestroyed&&s(g.data.timeUpdate)):(g.data.timeUpdate=function(a){v.timeUpdate(g,a)},g.isDestroyed||g.media.addEventListener("timeupdate",g.data.timeUpdate,!1))};return g.media.addEventListener("error",function(){g.error=g.media.error},!1),g.media.readyState>=1?i():g.media.addEventListener("loadedmetadata",i,!1),this}if("complete"===b.readyState)return void a(b,v);if(o.push(a),!p){p=!0;var j=function(){q=!0,b.removeEventListener("DOMContentLoaded",j,!1);for(var a=0,c=o.length;c>a;a++)o[a].call(b,v);o=null};b.addEventListener("DOMContentLoaded",j,!1)}}}},v.p.init.prototype=v.p,v.byId=function(a){for(var b=v.instances,c=b.length,d=0;c>d;d++)if(b[d].id===a)return b[d];return null},v.forEach=function(a,b,c){if(!a||!b)return{};c=c||this;var d,e;if(j&&a.forEach===j)return a.forEach(b,c);if("[object NodeList]"===m.call(a)){for(d=0,e=a.length;e>d;d++)b.call(c,a[d],d,a);return a}for(d in a)l.call(a,d)&&b.call(c,a[d],d,a);return a},v.extend=function(a){var b=a,c=k.call(arguments,1);return v.forEach(c,function(a){for(var c in a)b[c]=a[c]}),b},v.extend(v,{noConflict:function(b){return b&&(a.Popcorn=n),v},error:function(a){throw new Error(a)},guid:function(a){return v.guid.counter++,(a?a:"")+(+new Date+v.guid.counter)},sizeOf:function(a){var b=0;for(var c in a)b++;return b},isArray:Array.isArray||function(a){return"[object Array]"===m.call(a)},nop:function(){},position:function(c){if(!c.parentNode)return null;var d,e,f,g,h,i,j=c.getBoundingClientRect(),k={},l=(c.ownerDocument,b.documentElement),m=b.body;d=l.clientTop||m.clientTop||0,e=l.clientLeft||m.clientLeft||0,f=a.pageYOffset&&l.scrollTop||m.scrollTop,g=a.pageXOffset&&l.scrollLeft||m.scrollLeft,h=Math.ceil(j.top+f-d),i=Math.ceil(j.left+g-e);for(var n in j)k[n]=Math.round(j[n]);return v.extend({},k,{top:h,left:i})},disable:function(a,b){if(!a.data.disabled[b]){if(a.data.disabled[b]=!0,b in v.registryByName&&a.data.running[b])for(var c,d=a.data.running[b].length-1;d>=0;d--)c=a.data.running[b][d],c._natives.end.call(a,null,c),a.emit("trackend",v.extend({},c,{plugin:c.type,type:"trackend"}));return a}},enable:function(a,b){if(a.data.disabled[b]){if(a.data.disabled[b]=!1,b in v.registryByName&&a.data.running[b])for(var c,d=a.data.running[b].length-1;d>=0;d--)c=a.data.running[b][d],c._natives.start.call(a,null,c),a.emit("trackstart",v.extend({},c,{plugin:c.type,type:"trackstart",track:c}));return a}},destroy:function(a){var b,c,d,e,f=a.data.events,g=a.data.trackEvents;for(c in f){b=f[c];for(d in b)delete b[d];f[c]=null}for(e in v.registryByName)v.removePlugin(a,e);g.byStart.length=0,g.byEnd.length=0,a.isDestroyed||(a.data.timeUpdate&&a.media.removeEventListener("timeupdate",a.data.timeUpdate,!1),a.isDestroyed=!0),v.instances.splice(v.instances.indexOf(a),1)}}),v.guid.counter=1,v.extend(v.p,function(){var a="load play pause currentTime playbackRate volume duration preload playbackRate autoplay loop controls muted buffered readyState seeking paused played seekable ended",b={};return v.forEach(a.split(/\s+/g),function(a){b[a]=function(b){var c;return"function"==typeof this.media[a]?(null!=b&&/play|pause/.test(a)&&(this.media.currentTime=v.util.toSeconds(b)),this.media[a](),this):null!=b?(c=this.media[a],this.media[a]=b,c!==b&&this.emit("attrchange",{attribute:a,previousValue:c,currentValue:b}),this):this.media[a]}}),b}()),v.forEach("enable disable".split(" "),function(a){v.p[a]=function(b){return v[a](this,b)}}),v.extend(v.p,{roundTime:function(){return Math.round(this.media.currentTime)},exec:function(a,b,d){var e,f,g,h=arguments.length,i="trackadded";try{f=v.util.toSeconds(a)}catch(j){}if("number"==typeof f&&(a=f),"number"==typeof a&&2===h)d=b,b=a,a=v.guid("cue");else if(1===h)b=-1;else if(e=this.getTrackEvent(a))this.data.trackEvents.remove(a),c.end(this,e),v.removeTrackEvent.ref(this,a),i="cuechange","string"==typeof a&&2===h&&("number"==typeof b&&(d=e._natives.start),"function"==typeof b&&(d=b,b=e.start));else if(h>=2){if("string"==typeof b){try{f=v.util.toSeconds(b)}catch(j){}b=f}"number"==typeof b&&(d=d||v.nop()),"function"==typeof b&&(d=b,b=-1)}return g={id:a,start:b,end:b+1,_running:!1,_natives:{start:d||v.nop,end:v.nop,type:"cue"}},e&&(g=v.extend(e,g)),"cuechange"===i?(g._id=g.id||g._id||v.guid(g._natives.type),this.data.trackEvents.add(g),c.start(this,g),this.timeUpdate(this,null,!0),v.addTrackEvent.ref(this,g),this.emit(i,v.extend({},g,{id:a,type:i,previousValue:{time:e.start,fn:e._natives.start},currentValue:{time:b,fn:d||v.nop},track:e}))):v.addTrackEvent(this,g),this},mute:function(a){var b=null==a||a===!0?"muted":"unmuted";return"unmuted"===b&&(this.media.muted=!1,this.media.volume=this.data.state.volume),"muted"===b&&(this.data.state.volume=this.media.volume,this.media.muted=!0),this.emit(b),this},unmute:function(a){return this.mute(null==a?!1:!a)},position:function(){return v.position(this.media)},toggle:function(a){return v[this.data.disabled[a]?"enable":"disable"](this,a)},defaults:function(a,b){return v.isArray(a)?(v.forEach(a,function(a){for(var b in a)this.defaults(b,a[b])},this),this):(this.options.defaults||(this.options.defaults={}),this.options.defaults[a]||(this.options.defaults[a]={}),v.extend(this.options.defaults[a],b),this)}}),v.Events={UIEvents:"blur focus focusin focusout load resize scroll unload",MouseEvents:"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave click dblclick",Events:"loadstart progress suspend emptied stalled play pause error loadedmetadata loadeddata waiting playing canplay canplaythrough seeking seeked timeupdate ended ratechange durationchange volumechange"},v.Events.Natives=v.Events.UIEvents+" "+v.Events.MouseEvents+" "+v.Events.Events,r.events.apiTypes=["UIEvents","MouseEvents","Events"],function(a,b){for(var c=r.events.apiTypes,d=a.Natives.split(/\s+/g),e=0,f=d.length;f>e;e++)b.hash[d[e]]=!0;c.forEach(function(c){b.apis[c]={};for(var d=a[c].split(/\s+/g),e=d.length,f=0;e>f;f++)b.apis[c][d[f]]=!0})}(v.Events,r.events),v.events={isNative:function(a){return!!r.events.hash[a]},getInterface:function(a){if(!v.events.isNative(a))return!1;for(var b,c,d=r.events,e=d.apiTypes,f=d.apis,g=0,h=e.length;h>g;g++)if(c=e[g],f[c][a]){b=c;break}return b},all:v.Events.Natives.split(/\s+/g),fn:{trigger:function(c,d){var e,f,g,h=this.data.events[c];if(h){if(e=v.events.getInterface(c))return f=b.createEvent(e),f.initEvent(c,!0,!0,a,1),this.media.dispatchEvent(f),this;for(g=h.slice();g.length;)g.shift().call(this,d)}return this},listen:function(a,b){var c,d,e=this,f=!0,g=v.events.hooks[a];if("function"!=typeof b)throw new Error("Popcorn.js Error: Listener is not a function");return this.data.events[a]||(this.data.events[a]=[],f=!1),g&&(g.add&&g.add.call(this,{},b),g.bind&&(a=g.bind),g.handler&&(d=b,b=function(a){g.handler.call(e,a,d)}),f=!0,this.data.events[a]||(this.data.events[a]=[],f=!1)),this.data.events[a].push(b),!f&&v.events.all.indexOf(a)>-1&&this.media.addEventListener(a,function(b){if(e.data.events[a])for(c=e.data.events[a].slice();c.length;)c.shift().call(e,b)},!1),this},unlisten:function(a,b){var c,d=this.data.events[a];if(d){if("string"==typeof b){for(var e=0;e<d.length;e++)d[e].name===b&&d.splice(e--,1);return this}if("function"==typeof b){for(;-1!==c;)c=d.indexOf(b),-1!==c&&d.splice(c,1);return this}return this.data.events[a]=null,this}}},hooks:{canplayall:{bind:"canplaythrough",add:function(a,b){var c=!1;this.media.readyState&&(setTimeout(function(){b.call(this,a)}.bind(this),0),c=!0),this.data.hooks.canplayall={fired:c}},handler:function(a,b){this.data.hooks.canplayall.fired||(b.call(this,a),this.data.hooks.canplayall.fired=!0)}}}},v.forEach([["trigger","emit"],["listen","on"],["unlisten","off"]],function(a){v.p[a[0]]=v.p[a[1]]=v.events.fn[a[0]]}),c.start=function(a,b){b.end>a.media.currentTime&&b.start<=a.media.currentTime&&!b._running&&(b._running=!0,a.data.running[b._natives.type].push(b),a.data.disabled[b._natives.type]||(b._natives.start.call(a,null,b),a.emit("trackstart",v.extend({},b,{plugin:b._natives.type,type:"trackstart",track:b}))))},c.end=function(a,b){var c;(b.end<=a.media.currentTime||b.start>a.media.currentTime)&&b._running&&(c=a.data.running[b._natives.type],b._running=!1,c.splice(c.indexOf(b),1),a.data.disabled[b._natives.type]||(b._natives.end.call(a,null,b),a.emit("trackend",v.extend({},b,{plugin:b._natives.type,type:"trackend",track:b}))))},d.prototype.where=function(a){return(this.parent.getTrackEvents()||[]).filter(function(b){var c,d;if(!a)return!0;for(c in a)if(d=a[c],e(b,c,d)||e(b._natives,c,d))return!0;return!1})},d.prototype.add=function(a){var b,c,d=this.byStart,e=this.byEnd;for(a&&a._id&&this.parent.data.history.push(a._id),a.start=v.util.toSeconds(a.start,this.parent.options.framerate),a.end=v.util.toSeconds(a.end,this.parent.options.framerate),b=d.length-1;b>=0;b--)if(a.start>=d[b].start){d.splice(b+1,0,a);break}for(c=e.length-1;c>=0;c--)if(a.end>e[c].end){e.splice(c+1,0,a);break}b<=this.parent.data.trackEvents.startIndex&&a.start<=this.parent.data.trackEvents.previousUpdateTime&&this.parent.data.trackEvents.startIndex++,c<=this.parent.data.trackEvents.endIndex&&a.end<this.parent.data.trackEvents.previousUpdateTime&&this.parent.data.trackEvents.endIndex++,this.count++},d.prototype.remove=function(a,b){if(a instanceof c&&(a=a.id),"object"==typeof a)return this.where(a).forEach(function(a){this.removeTrackEvent(a._id)},this.parent),this;var d,e,f,g,h,i=this.byStart.length,j=0,k=0,l=[],m=[],n=[],o=[];for(b=b||{};--i>-1;)d=this.byStart[j],e=this.byEnd[j],d._id||(l.push(d),m.push(e)),d._id&&(d._id!==a&&l.push(d),e._id!==a&&m.push(e),d._id===a&&(k=j,h=d)),j++;if(i=this.animating.length,j=0,i)for(;--i>-1;)f=this.animating[j],f._id||n.push(f),f._id&&f._id!==a&&n.push(f),j++;k<=this.startIndex&&this.startIndex--,k<=this.endIndex&&this.endIndex--,this.byStart=l,this.byEnd=m,this.animating=n,this.count--,g=this.parent.data.history.length;for(var p=0;g>p;p++)this.parent.data.history[p]!==a&&o.push(this.parent.data.history[p]);this.parent.data.history=o},v.addTrackEvent=function(a,b){var d;b instanceof c||(b=new c(b),b&&b._natives&&b._natives.type&&a.options.defaults&&a.options.defaults[b._natives.type]&&(d=v.extend({},b),v.extend(b,a.options.defaults[b._natives.type],d)),b._natives&&(b._id=b.id||b._id||v.guid(b._natives.type),b._natives._setup&&(b._natives._setup.call(a,b),a.emit("tracksetup",v.extend({},b,{plugin:b._natives.type,type:"tracksetup",track:b})))),a.data.trackEvents.add(b),c.start(a,b),this.timeUpdate(a,null,!0),b._id&&v.addTrackEvent.ref(a,b),a.emit("trackadded",v.extend({},b,b._natives?{plugin:b._natives.type}:{},{type:"trackadded",track:b})))},v.addTrackEvent.ref=function(a,b){return a.data.trackRefs[b._id]=b,a},v.removeTrackEvent=function(a,b){var c=a.getTrackEvent(b);c&&(c._natives._teardown&&c._natives._teardown.call(a,c),a.data.trackEvents.remove(b),v.removeTrackEvent.ref(a,b),c._natives&&a.emit("trackremoved",v.extend({},c,{plugin:c._natives.type,type:"trackremoved",track:c})))},v.removeTrackEvent.ref=function(a,b){return delete a.data.trackRefs[b],a},v.getTrackEvents=function(a){for(var b,c=[],d=a.data.trackEvents.byStart,e=d.length,f=0;e>f;f++)b=d[f],b._id&&c.push(b);return c},v.getTrackEvents.ref=function(a){return a.data.trackRefs},v.getTrackEvent=function(a,b){return a.data.trackRefs[b]},v.getTrackEvent.ref=function(a,b){return a.data.trackRefs[b]},v.getLastTrackEventId=function(a){return a.data.history[a.data.history.length-1]},v.timeUpdate=function(a,b){var c,d,e,f,g,h=a.media.currentTime,i=a.data.trackEvents.previousUpdateTime,j=a.data.trackEvents,k=j.endIndex,l=j.startIndex,m=j.byStart.length,n=j.byEnd.length,o=v.registryByName,p="trackstart",q="trackend";if(h>=i){for(;j.byEnd[k]&&j.byEnd[k].end<=h;){if(c=j.byEnd[k],e=c._natives,f=e&&e.type,e&&!o[f]&&!a[f])return void v.removeTrackEvent(a,c._id);c._running===!0&&(c._running=!1,g=a.data.running[f],g.splice(g.indexOf(c),1),a.data.disabled[f]||(e.end.call(a,b,c),a.emit(q,v.extend({},c,{plugin:f,type:q,track:c})))),k++}for(;j.byStart[l]&&j.byStart[l].start<=h;){if(d=j.byStart[l],e=d._natives,f=e&&e.type,e&&!o[f]&&!a[f])return void v.removeTrackEvent(a,d._id);d.end>h&&d._running===!1&&(d._running=!0,a.data.running[f].push(d),a.data.disabled[f]||(e.start.call(a,b,d),a.emit(p,v.extend({},d,{plugin:f,type:p,track:d})))),l++}}else if(i>h){for(;j.byStart[l]&&j.byStart[l].start>h;){if(d=j.byStart[l],e=d._natives,f=e&&e.type,e&&!o[f]&&!a[f])return void v.removeTrackEvent(a,d._id);d._running===!0&&(d._running=!1,g=a.data.running[f],g.splice(g.indexOf(d),1),a.data.disabled[f]||(e.end.call(a,b,d),a.emit(q,v.extend({},d,{plugin:f,type:q,track:d})))),l--}for(;j.byEnd[k]&&j.byEnd[k].end>h;){if(c=j.byEnd[k],e=c._natives,f=e&&e.type,e&&!o[f]&&!a[f])return void v.removeTrackEvent(a,c._id);c.start<=h&&c._running===!1&&(c._running=!0,a.data.running[f].push(c),a.data.disabled[f]||(e.start.call(a,b,c),a.emit(p,v.extend({},c,{plugin:f,type:p,track:c})))),k--}}j.endIndex=k,j.startIndex=l,j.previousUpdateTime=h,j.byStart.length<m&&j.startIndex--,j.byEnd.length<n&&j.endIndex--},v.extend(v.p,{getTrackEvents:function(){return v.getTrackEvents.call(null,this)},getTrackEvent:function(a){return v.getTrackEvent.call(null,this,a)},getLastTrackEventId:function(){return v.getLastTrackEventId.call(null,this)},removeTrackEvent:function(a){return v.removeTrackEvent.call(null,this,a),this},removePlugin:function(a){return v.removePlugin.call(null,this,a),this},timeUpdate:function(a){return v.timeUpdate.call(null,this,a),this},destroy:function(){return v.destroy.call(null,this),this}}),v.manifest={},v.registry=[],v.registryByName={},v.plugin=function(a,b,d){if(v.protect.natives.indexOf(a.toLowerCase())>=0)return void v.error("'"+a+"' is a protected function name");var e="function"==typeof b,h=["start","end","type","manifest"],i=["_setup","_teardown","start","end","frame"],j={},m=function(a,b){return a=a||v.nop,b=b||v.nop,function(){a.apply(this,arguments),b.apply(this,arguments)}};v.manifest[a]=d=d||b.manifest||{},i.forEach(function(c){b[c]=g(b[c]||v.nop,a)});var n=function(b,e){if(!e)return this;if(e.ranges&&v.isArray(e.ranges))return v.forEach(e.ranges,function(b){var c=v.extend({},e,b);delete c.ranges,this[a](c)},this),this;var f,g=e._natives={},j="";return v.extend(g,b),e._natives.type=e._natives.plugin=a,e._running=!1,g.start=g.start||g["in"],g.end=g.end||g.out,e.once&&(g.end=m(g.end,function(){this.removeTrackEvent(e._id)})),g._teardown=m(function(){var a=k.call(arguments),b=this.data.running[g.type];a.unshift(null),a[1]._running&&b.splice(b.indexOf(e),1)&&g.end.apply(this,a),a[1]._running=!1,this.emit("trackend",v.extend({},e,{plugin:g.type,type:"trackend",track:v.getTrackEvent(this,e.id||e._id)}))},g._teardown),g._teardown=m(g._teardown,function(){this.emit("trackteardown",v.extend({},e,{plugin:a,type:"trackteardown",track:v.getTrackEvent(this,e.id||e._id)}))}),e.compose=e.compose||[],"string"==typeof e.compose&&(e.compose=e.compose.split(" ")),e.effect=e.effect||[],"string"==typeof e.effect&&(e.effect=e.effect.split(" ")),e.compose=e.compose.concat(e.effect),e.compose.forEach(function(a){j=v.compositions[a]||{},i.forEach(function(a){g[a]=m(g[a],j[a])})}),e._natives.manifest=d,"start"in e||(e.start=e["in"]||0),e.end||0===e.end||(e.end=e.out||Number.MAX_VALUE),l.call(e,"toString")||(e.toString=function(){var b=["start: "+e.start,"end: "+e.end,"id: "+(e.id||e._id)];return null!=e.target&&b.push("target: "+e.target),a+" ( "+b.join(", ")+" )"}),e.target||(f="options"in d&&d.options,e.target=f&&"target"in f&&f.target),!e._id&&e._natives&&(e._id=v.guid(e._natives.type)),e instanceof c?(e._natives&&(e._id=e.id||e._id||v.guid(e._natives.type),e._natives._setup&&(e._natives._setup.call(this,e),this.emit("tracksetup",v.extend({},e,{plugin:e._natives.type,type:"tracksetup",track:e})))),this.data.trackEvents.add(e),c.start(this,e),this.timeUpdate(this,null,!0),e._id&&v.addTrackEvent.ref(this,e)):v.addTrackEvent(this,e),v.forEach(b,function(a,b){-1===h.indexOf(b)&&this.on(b,a)},this),this};v.p[a]=j[a]=function(d,g){{var h,i,j,k,m;arguments.length}if(d&&!g)g=d,d=null;else{if(h=this.getTrackEvent(d))return m=g,k=f(h,m),h._natives._update?(this.data.trackEvents.remove(h),l.call(g,"start")&&(h.start=g.start),l.call(g,"end")&&(h.end=g.end),c.end(this,h),e&&b.call(this,h),h._natives._update.call(this,h,g),this.data.trackEvents.add(h),c.start(this,h),"cue"!==h._natives.type&&this.emit("trackchange",{id:h.id,type:"trackchange",previousValue:k,currentValue:m,track:h}),this):(v.extend(h,g),this.data.trackEvents.remove(d),h._natives._teardown&&h._natives._teardown.call(this,h),v.removeTrackEvent.ref(this,d),e?n.call(this,b.call(this,h),h):(h._id=h.id||h._id||v.guid(h._natives.type),h._natives&&h._natives._setup&&(h._natives._setup.call(this,h),this.emit("tracksetup",v.extend({},h,{plugin:h._natives.type,type:"tracksetup",track:h}))),this.data.trackEvents.add(h),c.start(this,h),this.timeUpdate(this,null,!0),v.addTrackEvent.ref(this,h)),this.emit("trackchange",{id:h.id,type:"trackchange",previousValue:k,currentValue:h,track:h}),this);g.id=d}return this.data.running[a]=this.data.running[a]||[],i=this.options.defaults&&this.options.defaults[a]||{},j=v.extend({},i,g),n.call(this,e?b.call(this,j):b,j),this},d&&v.extend(b,{manifest:d});var o={fn:j[a],definition:b,base:b,parents:[],name:a};return v.registry.push(v.extend(j,o,{type:a})),v.registryByName[a]=o,j},v.plugin.errors=[],v.plugin.debug="@VERSION"===v.version,v.removePlugin=function(a,b){if(!b){if(b=a,a=v.p,v.protect.natives.indexOf(b.toLowerCase())>=0)return void v.error("'"+b+"' is a protected function name");var c,d=v.registry.length;for(c=0;d>c;c++)if(v.registry[c].name===b)return v.registry.splice(c,1),delete v.registryByName[b],delete v.manifest[b],void delete a[b]}var e,f,g=a.data.trackEvents.byStart,h=a.data.trackEvents.byEnd,i=a.data.trackEvents.animating;for(e=0,f=g.length;f>e;e++)g[e]&&g[e]._natives&&g[e]._natives.type===b&&(g[e]._natives._teardown&&g[e]._natives._teardown.call(a,g[e]),g.splice(e,1),e--,f--,a.data.trackEvents.startIndex<=e&&(a.data.trackEvents.startIndex--,a.data.trackEvents.endIndex--)),h[e]&&h[e]._natives&&h[e]._natives.type===b&&h.splice(e,1);for(e=0,f=i.length;f>e;e++)i[e]&&i[e]._natives&&i[e]._natives.type===b&&(i.splice(e,1),e--,f--)},v.compositions={},v.compose=function(a,b,c){v.manifest[a]=c=c||b.manifest||{},v.compositions[a]=b},v.plugin.effect=v.effect=v.compose;var w=/^(?:\.|#|\[)/;v.dom={debug:!1,find:function(a,c){var d=null;if(c=c||b,a){if(!w.test(a)&&(d=b.getElementById(a),null!==d))return d;try{d=c.querySelector(a)}catch(e){if(v.dom.debug)throw new Error(e)}}return d}};var x=/\?/,y={ajax:null,url:"",data:"",dataType:"",success:v.nop,type:"GET",async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};v.xhr=function(a){var b;return a.dataType=a.dataType&&a.dataType.toLowerCase()||null,!a.dataType||"jsonp"!==a.dataType&&"script"!==a.dataType?(b=v.extend({},y,a),b.ajax=new XMLHttpRequest,b.ajax?("GET"===b.type&&b.data&&(b.url+=(x.test(b.url)?"&":"?")+b.data,b.data=null),b.ajax.open(b.type,b.url,b.async),"POST"===b.type&&b.ajax.setRequestHeader("Content-Type",b.contentType),b.ajax.send(b.data||null),v.xhr.httpData(b)):void 0):void v.xhr.getJSONP(a.url,a.success,"script"===a.dataType)},v.xhr.httpData=function(a){var b,c,d=null,e=null;return a.ajax.onreadystatechange=function(){if(4===a.ajax.readyState){try{d=JSON.parse(a.ajax.responseText)}catch(f){}if(b={xml:a.ajax.responseXML,text:a.ajax.responseText,json:d},!b.xml||!b.xml.documentElement){b.xml=null;try{c=new DOMParser,e=c.parseFromString(a.ajax.responseText,"text/xml"),e.getElementsByTagName("parsererror").length||(b.xml=e)}catch(f){}}a.dataType&&(b=b[a.dataType]),a.success.call(a.ajax,b)}},b},v.xhr.getJSONP=function(a,c,d){var e,f,g,h=b.head||b.getElementsByTagName("head")[0]||b.documentElement,i=b.createElement("script"),j=!1,k=[],l=/(=)\?(?=&|$)|\?\?/;d||(g=a.match(/(callback=[^&]*)/),null!==g&&g.length?(e=g[1].split("=")[1],"?"===e&&(e="jsonp"),f=v.guid(e),a=a.replace(/(callback=[^&]*)/,"callback="+f)):(f=v.guid("jsonp"),l.test(a)&&(a=a.replace(l,"$1"+f)),k=a.split(/\?(.+)?/),a=k[0]+"?",k[1]&&(a+=k[1]+"&"),a+="callback="+f),window[f]=function(a){c&&c(a),j=!0}),i.addEventListener("load",function(){d&&c&&c(),j&&delete window[f],h.removeChild(i)},!1),i.addEventListener("error",function(a){c&&c({error:a}),d||delete window[f],h.removeChild(i)},!1),i.src=a,h.insertBefore(i,h.firstChild)},v.getJSONP=v.xhr.getJSONP,v.getScript=v.xhr.getScript=function(a,b){return v.xhr.getJSONP(a,b,!0)},v.util={toSeconds:function(a,b){var c,d,e,f,g,h,i=/^([0-9]+:){0,2}[0-9]+([.;][0-9]+)?$/,j="Invalid time format";return"number"==typeof a?a:("string"!=typeof a||i.test(a)||v.error(j),c=a.split(":"),d=c.length-1,e=c[d],e.indexOf(";")>-1&&(g=e.split(";"),h=0,b&&"number"==typeof b&&(h=parseFloat(g[1],10)/b),c[d]=parseInt(g[0],10)+h),f=c[0],{1:parseFloat(f,10),2:60*parseInt(f,10)+parseFloat(c[1],10),3:3600*parseInt(f,10)+60*parseInt(c[1],10)+parseFloat(c[2],10)}[c.length||1])}},v.p.cue=v.p.exec,v.protect={natives:t(v.p).map(function(a){return a.toLowerCase()})},v.forEach({listen:"on",unlisten:"off",trigger:"emit",exec:"cue"},function(a,b){var c=v.p[b];v.p[b]=function(){return"undefined"!=typeof console&&console.warn&&(console.warn("Deprecated method '"+b+"', "+(null==a?"do not use.":"use '"+a+"' instead.")),v.p[b]=c),v.p[a].apply(this,[].slice.call(arguments))}}),a.Popcorn=v}else{a.Popcorn={isSupported:!1};for(var z="byId forEach extend effects error guid sizeOf isArray nop position disable enable destroyaddTrackEvent removeTrackEvent getTrackEvents getTrackEvent getLastTrackEventId timeUpdate plugin removePlugin compose effect xhr getJSONP getScript".split(/\s+/);z.length;)a.Popcorn[z.shift()]=function(){}}}(window,window.document),function(a,b){function c(a){for(var b=c.options,d=b.parser[b.strictMode?"strict":"loose"].exec(a),e={},f=14;f--;)e[b.key[f]]=d[f]||"";return e[b.q.name]={},e[b.key[12]].replace(b.q.parser,function(a,c,d){c&&(e[b.q.name][c]=d)}),e}function d(){var d,f={};return Object.prototype.__defineGetter__||(f=b.createElement("div")),f._util={type:"HTML5",TIMEUPDATE_MS:250,MIN_WIDTH:300,MIN_HEIGHT:150,isAttributeSet:function(a){return"string"==typeof a||a===!0},parseUri:c},f.addEventListener=function(a,c,d){b.addEventListener(this._eventNamespace+a,c,d)},f.removeEventListener=function(a,c,d){b.removeEventListener(this._eventNamespace+a,c,d)},f.dispatchEvent=function(a){var c=b.createEvent("CustomEvent"),d={type:a,target:this.parentNode,data:null};c.initCustomEvent(this._eventNamespace+a,!1,!1,d),b.dispatchEvent(c)},f.load=a.nop,f.canPlayType=function(){return""},f.getBoundingClientRect=function(){return d.getBoundingClientRect()},f.NETWORK_EMPTY=0,f.NETWORK_IDLE=1,f.NETWORK_LOADING=2,f.NETWORK_NO_SOURCE=3,f.HAVE_NOTHING=0,f.HAVE_METADATA=1,f.HAVE_CURRENT_DATA=2,f.HAVE_FUTURE_DATA=3,f.HAVE_ENOUGH_DATA=4,Object.defineProperties(f,{currentSrc:{get:function(){return void 0!==this.src?this.src:""},configurable:!0},parentNode:{get:function(){return d},set:function(a){d=a},configurable:!0},preload:{get:function(){return"auto"},set:a.nop,configurable:!0},controls:{get:function(){return!0},set:a.nop,configurable:!0},poster:{get:function(){return""},set:a.nop,configurable:!0},crossorigin:{get:function(){return""},configurable:!0},played:{get:function(){return e},configurable:!0},seekable:{get:function(){return e},configurable:!0},buffered:{get:function(){return e},configurable:!0},defaultMuted:{get:function(){return!1},configurable:!0},defaultPlaybackRate:{get:function(){return 1},configurable:!0},style:{get:function(){return this.parentNode.style},configurable:!0},id:{get:function(){return this.parentNode.id},configurable:!0}}),f}c.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var e={length:0,start:a.nop,end:a.nop};window.MediaError=window.MediaError||function(){function a(a,b){this.code=a||null,this.message=b||""}return a.MEDIA_ERR_NONE_ACTIVE=0,a.MEDIA_ERR_ABORTED=1,a.MEDIA_ERR_NETWORK=2,a.MEDIA_ERR_DECODE=3,a.MEDIA_ERR_NONE_SUPPORTED=4,a}(),a._MediaElementProto=d}(Popcorn,window.document),function(a,b,c){function d(){var a;if(YT.loaded)for(l=!0;n.length;)(a=n.shift())();else setTimeout(d,250)}function e(){var a;return m||(b.YT?d():(a=c.createElement("script"),a.addEventListener("load",d,!1),a.src="https://www.youtube.com/iframe_api",c.head.appendChild(a)),m=!0),l}function f(a){n.push(a)}function g(d){function g(a){X.push(a)}function l(){L.pauseVideo(),t("play",l),s("play",F)}function m(){s("pause",H),t("pause",m)}function n(){var a=function(){L.isMuted()?(s("play",r),L.playVideo()):setTimeout(a,0)};T=!0,L.mute(),a()}function o(a){var b={name:"MediaError"};switch(a.data){case 2:b.message="Invalid video parameter.",b.code=MediaError.MEDIA_ERR_ABORTED;break;case 5:b.message="The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",b.code=MediaError.MEDIA_ERR_DECODE;case 100:b.message="Video not found.",b.code=MediaError.MEDIA_ERR_NETWORK;break;case 101:case 150:b.message="Video not usable.",b.code=MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:b.message="Unknown error.",b.code=5}S.error=b,P.dispatchEvent("error")}function p(){for(s("play",F),s("pause",H),(S.autoplay||!S.paused)&&(t("play",p),S.paused=!1,g(function(){S.paused||F()})),S.muted||L.unMute(),S.readyState=P.HAVE_METADATA,P.dispatchEvent("loadedmetadata"),N=setInterval(z,h),P.dispatchEvent("loadeddata"),S.readyState=P.HAVE_FUTURE_DATA,P.dispatchEvent("canplay"),U=!0,M=setInterval(A,50);X.length;)X[0](),X.shift();S.readyState=P.HAVE_ENOUGH_DATA,P.dispatchEvent("canplaythrough")}function q(){return t("pause",q),L.getCurrentTime()>0?void setTimeout(q,0):void(S.autoplay||!S.paused?(s("play",p),L.playVideo()):p())}function r(){return t("play",r),0===L.getCurrentTime()?void setTimeout(r,0):(s("pause",q),L.seekTo(0),void L.pauseVideo())}function s(a,b){P.addEventListener("youtube-"+a,b,!1)}function t(a,b){P.removeEventListener("youtube-"+a,b,!1)}function u(a){P.dispatchEvent("youtube-"+a)}function v(){S.networkState=P.NETWORK_LOADING,P.dispatchEvent("waiting")}function w(a){switch(a.data){case YT.PlayerState.ENDED:u("ended");break;case YT.PlayerState.PLAYING:u("play");break;case YT.PlayerState.PAUSED:L.getDuration()!==L.getCurrentTime()&&u("pause");break;case YT.PlayerState.BUFFERING:u("buffering");break;case YT.PlayerState.CUED:}a.data!==YT.PlayerState.BUFFERING&&Y===YT.PlayerState.BUFFERING&&G(),Y=a.data}function x(){T&&L&&(t("buffering",v),t("ended",I),t("play",F),t("pause",H),H(),U=!1,V=!1,S.currentTime=0,X=[],clearInterval(N),clearInterval(M),L.stopVideo(),L.clearVideo(),L.destroy(),R=c.createElement("div"))}function y(c){if(!P._canPlaySrc(c))return S.error={name:"MediaError",message:"Media Source Not Supported",code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED},void P.dispatchEvent("error");if(S.src=c,!e())return void f(function(){y(c)});if(T){if(!U)return void g(function(){y(c)});x()}Q.appendChild(R);var d=P._util.parseUri(c).queryKey;delete d.v,S.autoplay="1"===d.autoplay||S.autoplay,delete d.autoplay,S.loop="1"===d.loop||S.loop,delete d.loop,d.rel=d.rel||0,d.modestbranding=d.modestbranding||1,d.iv_load_policy=d.iv_load_policy||3,d.disablekb=d.disablekb||1,d.showinfo=d.showinfo||0;var h="file:"===b.location.protocol?"*":b.location.protocol+"//"+b.location.host;d.origin=d.origin||h,d.controls=d.controls||S.controls?2:0,S.controls=d.controls,d.wmode=d.wmode||"opaque",c=j.exec(c)[1];var i="https://gdata.youtube.com/feeds/api/videos/"+c+"?v=2&alt=jsonc&callback=?";a.getJSONP(i,function(a){var b="failed to retreive duration data, reason: ";return a.error?void console.warn(b+a.error.message):a.data?(S.duration=a.data.duration,P.dispatchEvent("durationchange"),L=new YT.Player(R,{width:"100%",height:"100%",wmode:d.wmode,videoId:c,playerVars:d,events:{onReady:n,onError:o,onStateChange:w}}),S.networkState=P.NETWORK_LOADING,P.dispatchEvent("loadstart"),void P.dispatchEvent("progress")):void console.warn(b+"no response data")})}function z(){var a=L.getCurrentTime();S.seeking?k(a-S.currentTime)<1&&E():(k(S.currentTime-a)>h&&(D(),E()),S.currentTime=a)}function A(){var a=L.getVideoLoadedFraction();a&&Z!==a&&(Z=a,G())}function B(a){if(a!==S.currentTime){if(S.currentTime=a,!U)return void g(function(){D(),L.seekTo(a)});D(),L.seekTo(a)}}function C(){P.dispatchEvent("timeupdate")}function D(){s("pause",m),t("pause",H),S.seeking=!0,P.dispatchEvent("seeking")}function E(){S.ended=!1,S.seeking=!1,P.dispatchEvent("timeupdate"),P.dispatchEvent("seeked"),P.dispatchEvent("canplay"),P.dispatchEvent("canplaythrough")}function F(){S.ended&&(B(0),S.ended=!1),O=setInterval(C,P._util.TIMEUPDATE_MS),S.paused=!1,W&&(W=!1,(S.loop&&!V||!S.loop)&&(V=!0,P.dispatchEvent("play")),P.dispatchEvent("playing"))}function G(){P.dispatchEvent("progress")}function H(){S.paused=!0,W||(W=!0,clearInterval(O),P.dispatchEvent("pause"))}function I(){S.loop?(B(0),P.play()):(S.ended=!0,H(),s("play",l),t("play",F),P.dispatchEvent("timeupdate"),P.dispatchEvent("ended"))}function J(a){return S.muted=a,U?(L[a?"mute":"unMute"](),void P.dispatchEvent("volumechange")):void g(function(){J(S.muted)})}function K(){return S.muted}if(!b.postMessage)throw"ERROR: HTMLYouTubeVideoElement requires window.postMessage";var L,M,N,O,P=new a._MediaElementProto,Q="string"==typeof d?c.querySelector(d):d,R=c.createElement("div"),S={src:i,networkState:P.NETWORK_EMPTY,readyState:P.HAVE_NOTHING,seeking:!1,autoplay:i,preload:i,controls:!1,loop:!1,poster:i,volume:1,muted:!1,currentTime:0,duration:0/0,ended:!1,paused:!0,error:null},T=!1,U=!1,V=!1,W=!0,X=[],Y=-1,Z=0;return P._eventNamespace=a.guid("HTMLYouTubeVideoElement::"),P.parentNode=Q,P._util.type="YouTube",s("buffering",v),s("ended",I),P.play=function(){return S.paused=!1,U?void L.playVideo():void g(function(){P.play()})},P.pause=function(){return S.paused=!0,U?(m(),void L.pauseVideo()):void g(function(){P.pause()})},Object.defineProperties(P,{src:{get:function(){return S.src},set:function(a){a&&a!==S.src&&y(a)}},autoplay:{get:function(){return S.autoplay},set:function(a){S.autoplay=P._util.isAttributeSet(a)}},loop:{get:function(){return S.loop},set:function(a){S.loop=P._util.isAttributeSet(a)}},width:{get:function(){return P.parentNode.offsetWidth}},height:{get:function(){return P.parentNode.offsetHeight}},currentTime:{get:function(){return S.currentTime},set:function(a){B(a)}},duration:{get:function(){return S.duration}},ended:{get:function(){return S.ended}},paused:{get:function(){return S.paused}},seeking:{get:function(){return S.seeking}},readyState:{get:function(){return S.readyState}},networkState:{get:function(){return S.networkState}},volume:{get:function(){return S.volume},set:function(a){if(0>a||a>1)throw"Volume value must be between 0.0 and 1.0";return S.volume=a,U?(L.setVolume(100*S.volume),void P.dispatchEvent("volumechange")):void g(function(){P.volume=a})}},muted:{get:function(){return K()},set:function(a){J(P._util.isAttributeSet(a))}},error:{get:function(){return S.error}},buffered:{get:function(){var a={start:function(a){if(0===a)return 0;throw"INDEX_SIZE_ERR: DOM Exception 1"},end:function(a){if(0===a)return S.duration?S.duration*Z:0;throw"INDEX_SIZE_ERR: DOM Exception 1"},length:1};return a},configurable:!0}}),P._canPlaySrc=a.HTMLYouTubeVideoElement._canPlaySrc,P.canPlayType=a.HTMLYouTubeVideoElement.canPlayType,P}var h=10,i="",j=/^.*(?:\/|v=)(.{11})/,k=Math.abs,l=!1,m=!1,n=[];a.HTMLYouTubeVideoElement=function(a){return new g(a)},a.HTMLYouTubeVideoElement._canPlaySrc=function(a){return/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu).*(?:\/|v=)(.{11})/.test(a)?"probably":i},a.HTMLYouTubeVideoElement.canPlayType=function(a){return"video/x-youtube"===a?"probably":i}}(Popcorn,window,document),function(a){a.plugin("transcript",function(){var a;return{manifest:{about:{name:"Popcorn Transcript Plugin",version:"0.2",author:"Mark Panaghiston",website:"http://www.jplayer.org/"},options:{time:{elem:"input",type:"text",label:"In"},target:"Transcript-container",futureClass:{elem:"input",type:"text",label:"Class"},onNewPara:function(){}}},_setup:function(b){var c,d;if(b.target&&"string"==typeof b.target&&"Transcript-container"!==b.target)b.container=document.getElementById(b.target);else{if(!b.target||"object"!=typeof b.target)throw"Popcorn.transcript: target property must be an ID string or a pointer to the DOM of the transcript word.";b.container=b.target}b.start=0,b.end=b.time,b.futureClass||(b.futureClass="transcript-future"),c=b.target.parentNode,c!==a&&(d=!0,a=c),b.transcriptRead=function(){b.container.classList?b.container.classList.remove(b.futureClass):b.container.className="",d&&"function"==typeof b.onNewPara&&b.onNewPara(b.target.parentNode)},b.transcriptFuture=function(){b.container.classList?b.container.classList.add(b.futureClass):b.container.className=b.futureClass},b.end<=this.media.currentTime?b.transcriptRead():b.transcriptFuture()},_update:function(){},_teardown:function(){},start:function(a,b){b.transcriptFuture()},end:function(a,b){b.transcriptRead()}}}())}(Popcorn),function(a,b,c){function d(a,c){this.wrapper="string"==typeof a?b.querySelector(a):a,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var d in c)this.options[d]=c[d];this.translateZ=this.options.HWCompositing&&h.hasPerspective?" translateZ(0)":"",this.options.useTransition=h.hasTransition&&this.options.useTransition,this.options.useTransform=h.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?h.ease[this.options.bounceEasing]||h.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function e(a,c,d){var e=b.createElement("div"),f=b.createElement("div");return d===!0&&(e.style.cssText="position:absolute;z-index:9999",f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),f.className="iScrollIndicator","h"==a?(d===!0&&(e.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",f.style.height="100%"),e.className="iScrollHorizontalScrollbar"):(d===!0&&(e.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",f.style.width="100%"),e.className="iScrollVerticalScrollbar"),e.style.cssText+=";overflow:hidden",c||(e.style.pointerEvents="none"),e.appendChild(f),e}function f(c,d){this.wrapper="string"==typeof d.el?b.querySelector(d.el):d.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=c,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var e in d)this.options[e]=d[e];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(h.addEvent(this.indicator,"touchstart",this),h.addEvent(a,"touchend",this)),this.options.disablePointer||(h.addEvent(this.indicator,h.prefixPointerEvent("pointerdown"),this),h.addEvent(a,h.prefixPointerEvent("pointerup"),this)),this.options.disableMouse||(h.addEvent(this.indicator,"mousedown",this),h.addEvent(a,"mouseup",this))),this.options.fade&&(this.wrapperStyle[h.style.transform]=this.scroller.translateZ,this.wrapperStyle[h.style.transitionDuration]=h.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var g=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},h=function(){function d(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}var e={},f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in f)return b[c].substr(0,b[c].length-1);return!1}();e.getTime=Date.now||function(){return(new Date).getTime()},e.extend=function(a,b){for(var c in b)a[c]=b[c]},e.addEvent=function(a,b,c,d){a.addEventListener(b,c,!!d)},e.removeEvent=function(a,b,c,d){a.removeEventListener(b,c,!!d)},e.prefixPointerEvent=function(b){return a.MSPointerEvent?"MSPointer"+b.charAt(9).toUpperCase()+b.substr(10):b},e.momentum=function(a,b,d,e,f,g){var h,i,j=a-b,k=c.abs(j)/d;return g=void 0===g?6e-4:g,h=a+k*k/(2*g)*(0>j?-1:1),i=k/g,e>h?(h=f?e-f/2.5*(k/8):e,j=c.abs(h-a),i=j/k):h>0&&(h=f?f/2.5*(k/8):0,j=c.abs(a)+h,i=j/k),{destination:c.round(h),duration:i}};var h=d("transform");return e.extend(e,{hasTransform:h!==!1,hasPerspective:d("perspective")in f,hasTouch:"ontouchstart"in a,hasPointer:a.PointerEvent||a.MSPointerEvent,hasTransition:d("transition")in f}),e.isBadAndroid=/Android /.test(a.navigator.appVersion)&&!/Chrome\/\d/.test(a.navigator.appVersion),e.extend(e.style={},{transform:h,transitionTimingFunction:d("transitionTimingFunction"),transitionDuration:d("transitionDuration"),transitionDelay:d("transitionDelay"),transformOrigin:d("transformOrigin")}),e.hasClass=function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},e.addClass=function(a,b){if(!e.hasClass(a,b)){var c=a.className.split(" ");c.push(b),a.className=c.join(" ")}},e.removeClass=function(a,b){if(e.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c," ")}},e.offset=function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}},e.preventDefaultException=function(a,b){for(var c in b)if(b[c].test(a[c]))return!0;return!1},e.extend(e.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),e.extend(e.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(a){return a*(2-a)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(a){return c.sqrt(1- --a*a)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(a){var b=4;return(a-=1)*a*((b+1)*a+b)+1}},bounce:{style:"",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}},elastic:{style:"",fn:function(a){var b=.22,d=.4;return 0===a?0:1==a?1:d*c.pow(2,-10*a)*c.sin(2*(a-b/4)*c.PI/b)+1}}}),e.tap=function(a,c){var d=b.createEvent("Event");d.initEvent(c,!0,!0),d.pageX=a.pageX,d.pageY=a.pageY,a.target.dispatchEvent(d)},e.click=function(a){var c,d=a.target;/(SELECT|INPUT|TEXTAREA)/i.test(d.tagName)||(c=b.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),c._constructed=!0,d.dispatchEvent(c))},e}();d.prototype={version:"5.1.2",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(a){a.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(a){if(!(1!=h.eventType[a.type]&&0!==a.button||!this.enabled||this.initiated&&h.eventType[a.type]!==this.initiated)){!this.options.preventDefault||h.isBadAndroid||h.preventDefaultException(a.target,this.options.preventDefaultException)||a.preventDefault();var b,d=a.touches?a.touches[0]:a;this.initiated=h.eventType[a.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=h.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=d.pageX,this.pointY=d.pageY,this._execEvent("beforeScrollStart")}},_move:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,f,g=a.touches?a.touches[0]:a,i=g.pageX-this.pointX,j=g.pageY-this.pointY,k=h.getTime();if(this.pointX=g.pageX,this.pointY=g.pageY,this.distX+=i,this.distY+=j,e=c.abs(this.distX),f=c.abs(this.distY),!(k-this.endTime>300&&10>e&&10>f)){if(this.directionLocked||this.options.freeScroll||(this.directionLocked=e>f+this.options.directionLockThreshold?"h":f>=e+this.options.directionLockThreshold?"v":"n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)a.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);j=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)a.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);i=0}i=this.hasHorizontalScroll?i:0,j=this.hasVerticalScroll?j:0,b=this.x+i,d=this.y+j,(b>0||b<this.maxScrollX)&&(b=this.options.bounce?this.x+i/3:b>0?0:this.maxScrollX),(d>0||d<this.maxScrollY)&&(d=this.options.bounce?this.y+j/3:d>0?0:this.maxScrollY),this.directionX=i>0?-1:0>i?1:0,this.directionY=j>0?-1:0>j?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(b,d),k-this.startTime>300&&(this.startTime=k,this.startX=this.x,this.startY=this.y)}}},_end:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&!h.preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();var b,d,e=(a.changedTouches?a.changedTouches[0]:a,h.getTime()-this.startTime),f=c.round(this.x),g=c.round(this.y),i=c.abs(f-this.startX),j=c.abs(g-this.startY),k=0,l="";if(this.isInTransition=0,this.initiated=0,this.endTime=h.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(f,g),!this.moved)return this.options.tap&&h.tap(a,this.options.tap),this.options.click&&h.click(a),void this._execEvent("scrollCancel");if(this._events.flick&&200>e&&100>i&&100>j)return void this._execEvent("flick");if(this.options.momentum&&300>e&&(b=this.hasHorizontalScroll?h.momentum(this.x,this.startX,e,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:f,duration:0},d=this.hasVerticalScroll?h.momentum(this.y,this.startY,e,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:g,duration:0},f=b.destination,g=d.destination,k=c.max(b.duration,d.duration),this.isInTransition=1),this.options.snap){var m=this._nearestSnap(f,g);this.currentPage=m,k=this.options.snapSpeed||c.max(c.max(c.min(c.abs(f-m.x),1e3),c.min(c.abs(g-m.y),1e3)),300),f=m.x,g=m.y,this.directionX=0,this.directionY=0,l=this.options.bounceEasing}return f!=this.x||g!=this.y?((f>0||f<this.maxScrollX||g>0||g<this.maxScrollY)&&(l=h.ease.quadratic),void this.scrollTo(f,g,k,l)):void this._execEvent("scrollEnd")}}},_resize:function(){var a=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},resetPosition:function(a){var b=this.x,c=this.y;return a=a||0,!this.hasHorizontalScroll||this.x>0?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX),!this.hasVerticalScroll||this.y>0?c=0:this.y<this.maxScrollY&&(c=this.maxScrollY),b==this.x&&c==this.y?!1:(this.scrollTo(b,c,a,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=h.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(a,b){this._events[a]||(this._events[a]=[]),this._events[a].push(b)},off:function(a,b){if(this._events[a]){var c=this._events[a].indexOf(b);c>-1&&this._events[a].splice(c,1)}},_execEvent:function(a){if(this._events[a]){var b=0,c=this._events[a].length;if(c)for(;c>b;b++)this._events[a][b].apply(this,[].slice.call(arguments,1))}},scrollBy:function(a,b,c,d){a=this.x+a,b=this.y+b,c=c||0,this.scrollTo(a,b,c,d)},scrollTo:function(a,b,c,d){d=d||h.ease.circular,this.isInTransition=this.options.useTransition&&c>0,!c||this.options.useTransition&&d.style?(this._transitionTimingFunction(d.style),this._transitionTime(c),this._translate(a,b)):this._animate(a,b,c,d.fn)},scrollToElement:function(a,b,d,e,f){if(a=a.nodeType?a:this.scroller.querySelector(a)){var g=h.offset(a);g.left-=this.wrapperOffset.left,g.top-=this.wrapperOffset.top,d===!0&&(d=c.round(a.offsetWidth/2-this.wrapper.offsetWidth/2)),e===!0&&(e=c.round(a.offsetHeight/2-this.wrapper.offsetHeight/2)),g.left-=d||0,g.top-=e||0,g.left=g.left>0?0:g.left<this.maxScrollX?this.maxScrollX:g.left,g.top=g.top>0?0:g.top<this.maxScrollY?this.maxScrollY:g.top,b=void 0===b||null===b||"auto"===b?c.max(c.abs(this.x-g.left),c.abs(this.y-g.top)):b,this.scrollTo(g.left,g.top,b,f)}},_transitionTime:function(a){if(a=a||0,this.scrollerStyle[h.style.transitionDuration]=a+"ms",!a&&h.isBadAndroid&&(this.scrollerStyle[h.style.transitionDuration]="0.001s"),this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTime(a)},_transitionTimingFunction:function(a){if(this.scrollerStyle[h.style.transitionTimingFunction]=a,this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTimingFunction(a)},_translate:function(a,b){if(this.options.useTransform?this.scrollerStyle[h.style.transform]="translate("+a+"px,"+b+"px)"+this.translateZ:(a=c.round(a),b=c.round(b),this.scrollerStyle.left=a+"px",this.scrollerStyle.top=b+"px"),this.x=a,this.y=b,this.indicators)for(var d=this.indicators.length;d--;)this.indicators[d].updatePosition()},_initEvents:function(b){var c=b?h.removeEvent:h.addEvent,d=this.options.bindToWrapper?this.wrapper:a;c(a,"orientationchange",this),c(a,"resize",this),this.options.click&&c(this.wrapper,"click",this,!0),this.options.disableMouse||(c(this.wrapper,"mousedown",this),c(d,"mousemove",this),c(d,"mousecancel",this),c(d,"mouseup",this)),h.hasPointer&&!this.options.disablePointer&&(c(this.wrapper,h.prefixPointerEvent("pointerdown"),this),c(d,h.prefixPointerEvent("pointermove"),this),c(d,h.prefixPointerEvent("pointercancel"),this),c(d,h.prefixPointerEvent("pointerup"),this)),h.hasTouch&&!this.options.disableTouch&&(c(this.wrapper,"touchstart",this),c(d,"touchmove",this),c(d,"touchcancel",this),c(d,"touchend",this)),c(this.scroller,"transitionend",this),c(this.scroller,"webkitTransitionEnd",this),c(this.scroller,"oTransitionEnd",this),c(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var b,c,d=a.getComputedStyle(this.scroller,null);return this.options.useTransform?(d=d[h.style.transform].split(")")[0].split(", "),b=+(d[12]||d[4]),c=+(d[13]||d[5])):(b=+d.left.replace(/[^-\d.]/g,""),c=+d.top.replace(/[^-\d.]/g,"")),{x:b,y:c}},_initIndicators:function(){function a(a){for(var b=h.indicators.length;b--;)a.call(h.indicators[b])}var b,c=this.options.interactiveScrollbars,d="string"!=typeof this.options.scrollbars,g=[],h=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(b={el:e("v",c,this.options.scrollbars),interactive:c,defaultScrollbars:!0,customStyle:d,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(b.el),g.push(b)),this.options.scrollX&&(b={el:e("h",c,this.options.scrollbars),interactive:c,defaultScrollbars:!0,customStyle:d,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(b.el),g.push(b))),this.options.indicators&&(g=g.concat(this.options.indicators));for(var i=g.length;i--;)this.indicators.push(new f(this,g[i]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){a(function(){this.fade()})}),this.on("scrollCancel",function(){a(function(){this.fade()})}),this.on("scrollStart",function(){a(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){a(function(){this.fade(1,!0)})})),this.on("refresh",function(){a(function(){this.refresh()})}),this.on("destroy",function(){a(function(){this.destroy()}),delete this.indicators})},_initWheel:function(){h.addEvent(this.wrapper,"wheel",this),h.addEvent(this.wrapper,"mousewheel",this),h.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){h.removeEvent(this.wrapper,"wheel",this),h.removeEvent(this.wrapper,"mousewheel",this),h.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(a){if(this.enabled){a.preventDefault(),a.stopPropagation();var b,d,e,f,g=this;if(void 0===this.wheelTimeout&&g._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){g._execEvent("scrollEnd"),g.wheelTimeout=void 0},400),"deltaX"in a)1===a.deltaMode?(b=-a.deltaX*this.options.mouseWheelSpeed,d=-a.deltaY*this.options.mouseWheelSpeed):(b=-a.deltaX,d=-a.deltaY);else if("wheelDeltaX"in a)b=a.wheelDeltaX/120*this.options.mouseWheelSpeed,d=a.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in a)b=d=a.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in a))return;b=d=-a.detail/3*this.options.mouseWheelSpeed}if(b*=this.options.invertWheelDirection,d*=this.options.invertWheelDirection,this.hasVerticalScroll||(b=d,d=0),this.options.snap)return e=this.currentPage.pageX,f=this.currentPage.pageY,b>0?e--:0>b&&e++,d>0?f--:0>d&&f++,void this.goToPage(e,f);e=this.x+c.round(this.hasHorizontalScroll?b:0),f=this.y+c.round(this.hasVerticalScroll?d:0),e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),f>0?f=0:f<this.maxScrollY&&(f=this.maxScrollY),this.scrollTo(e,f,0)}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var a,b,d,e,f,g,h=0,i=0,j=0,k=this.options.snapStepX||this.wrapperWidth,l=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(this.options.snap===!0)for(d=c.round(k/2),e=c.round(l/2);j>-this.scrollerWidth;){for(this.pages[h]=[],a=0,f=0;f>-this.scrollerHeight;)this.pages[h][a]={x:c.max(j,this.maxScrollX),y:c.max(f,this.maxScrollY),width:k,height:l,cx:j-d,cy:f-e},f-=l,a++;j-=k,h++}else for(g=this.options.snap,a=g.length,b=-1;a>h;h++)(0===h||g[h].offsetLeft<=g[h-1].offsetLeft)&&(i=0,b++),this.pages[i]||(this.pages[i]=[]),j=c.max(-g[h].offsetLeft,this.maxScrollX),f=c.max(-g[h].offsetTop,this.maxScrollY),d=j-c.round(g[h].offsetWidth/2),e=f-c.round(g[h].offsetHeight/2),this.pages[i][b]={x:j,y:f,width:g[h].offsetWidth,height:g[h].offsetHeight,cx:d,cy:e},j>this.maxScrollX&&i++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var a=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.x-this.startX),1e3),c.min(c.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,a)})},_nearestSnap:function(a,b){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var d=0,e=this.pages.length,f=0;if(c.abs(a-this.absStartX)<this.snapThresholdX&&c.abs(b-this.absStartY)<this.snapThresholdY)return this.currentPage;for(a>0?a=0:a<this.maxScrollX&&(a=this.maxScrollX),b>0?b=0:b<this.maxScrollY&&(b=this.maxScrollY);e>d;d++)if(a>=this.pages[d][0].cx){a=this.pages[d][0].x;break}for(e=this.pages[d].length;e>f;f++)if(b>=this.pages[0][f].cy){b=this.pages[0][f].y;break}return d==this.currentPage.pageX&&(d+=this.directionX,0>d?d=0:d>=this.pages.length&&(d=this.pages.length-1),a=this.pages[d][0].x),f==this.currentPage.pageY&&(f+=this.directionY,0>f?f=0:f>=this.pages[0].length&&(f=this.pages[0].length-1),b=this.pages[0][f].y),{x:a,y:b,pageX:d,pageY:f}},goToPage:function(a,b,d,e){e=e||this.options.bounceEasing,a>=this.pages.length?a=this.pages.length-1:0>a&&(a=0),b>=this.pages[a].length?b=this.pages[a].length-1:0>b&&(b=0);var f=this.pages[a][b].x,g=this.pages[a][b].y;d=void 0===d?this.options.snapSpeed||c.max(c.max(c.min(c.abs(f-this.x),1e3),c.min(c.abs(g-this.y),1e3)),300):d,this.currentPage={x:f,y:g,pageX:a,pageY:b},this.scrollTo(f,g,d,e)},next:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c++,c>=this.pages.length&&this.hasVerticalScroll&&(c=0,d++),this.goToPage(c,d,a,b)},prev:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c--,0>c&&this.hasVerticalScroll&&(c=0,d--),this.goToPage(c,d,a,b)},_initKeys:function(){var b,c={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(b in this.options.keyBindings)"string"==typeof this.options.keyBindings[b]&&(this.options.keyBindings[b]=this.options.keyBindings[b].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(b in c)this.options.keyBindings[b]=this.options.keyBindings[b]||c[b];h.addEvent(a,"keydown",this),this.on("destroy",function(){h.removeEvent(a,"keydown",this)})},_key:function(a){if(this.enabled){var b,d=this.options.snap,e=d?this.currentPage.pageX:this.x,f=d?this.currentPage.pageY:this.y,g=h.getTime(),i=this.keyTime||0,j=.25;switch(this.options.useTransition&&this.isInTransition&&(b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this.isInTransition=!1),this.keyAcceleration=200>g-i?c.min(this.keyAcceleration+j,50):0,a.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?e+=d?1:this.wrapperWidth:f+=d?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?e-=d?1:this.wrapperWidth:f-=d?1:this.wrapperHeight;break;case this.options.keyBindings.end:e=d?this.pages.length-1:this.maxScrollX,f=d?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:e=0,f=0;break;case this.options.keyBindings.left:e+=d?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:f+=d?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:e-=d?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:f-=d?1:5+this.keyAcceleration>>0;break;default:return}if(d)return void this.goToPage(e,f);e>0?(e=0,this.keyAcceleration=0):e<this.maxScrollX&&(e=this.maxScrollX,this.keyAcceleration=0),f>0?(f=0,this.keyAcceleration=0):f<this.maxScrollY&&(f=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(e,f,0),this.keyTime=g}},_animate:function(a,b,c,d){function e(){var m,n,o,p=h.getTime();return p>=l?(f.isAnimating=!1,f._translate(a,b),void(f.resetPosition(f.options.bounceTime)||f._execEvent("scrollEnd"))):(p=(p-k)/c,o=d(p),m=(a-i)*o+i,n=(b-j)*o+j,f._translate(m,n),void(f.isAnimating&&g(e)))}var f=this,i=this.x,j=this.y,k=h.getTime(),l=k+c;this.isAnimating=!0,e()},handleEvent:function(a){switch(a.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(a);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(a);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(a);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(a);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(a);break;case"keydown":this._key(a);break;case"click":a._constructed||(a.preventDefault(),a.stopPropagation())}}},f.prototype={handleEvent:function(a){switch(a.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(a);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(a);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(a)}},destroy:function(){this.options.interactive&&(h.removeEvent(this.indicator,"touchstart",this),h.removeEvent(this.indicator,h.prefixPointerEvent("pointerdown"),this),h.removeEvent(this.indicator,"mousedown",this),h.removeEvent(a,"touchmove",this),h.removeEvent(a,h.prefixPointerEvent("pointermove"),this),h.removeEvent(a,"mousemove",this),h.removeEvent(a,"touchend",this),h.removeEvent(a,h.prefixPointerEvent("pointerup"),this),h.removeEvent(a,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(b){var c=b.touches?b.touches[0]:b;b.preventDefault(),b.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=c.pageX,this.lastPointY=c.pageY,this.startTime=h.getTime(),this.options.disableTouch||h.addEvent(a,"touchmove",this),this.options.disablePointer||h.addEvent(a,h.prefixPointerEvent("pointermove"),this),this.options.disableMouse||h.addEvent(a,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(a){{var b,c,d,e,f=a.touches?a.touches[0]:a;h.getTime()}this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,b=f.pageX-this.lastPointX,this.lastPointX=f.pageX,c=f.pageY-this.lastPointY,this.lastPointY=f.pageY,d=this.x+b,e=this.y+c,this._pos(d,e),a.preventDefault(),a.stopPropagation()},_end:function(b){if(this.initiated){if(this.initiated=!1,b.preventDefault(),b.stopPropagation(),h.removeEvent(a,"touchmove",this),h.removeEvent(a,h.prefixPointerEvent("pointermove"),this),h.removeEvent(a,"mousemove",this),this.scroller.options.snap){var d=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),e=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.scroller.x-d.x),1e3),c.min(c.abs(this.scroller.y-d.y),1e3)),300);(this.scroller.x!=d.x||this.scroller.y!=d.y)&&(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=d,this.scroller.scrollTo(d.x,d.y,e,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(a){a=a||0,this.indicatorStyle[h.style.transitionDuration]=a+"ms",!a&&h.isBadAndroid&&(this.indicatorStyle[h.style.transitionDuration]="0.001s")},transitionTimingFunction:function(a){this.indicatorStyle[h.style.transitionTimingFunction]=a},refresh:function(){this.transitionTime(),this.indicatorStyle.display=this.options.listenX&&!this.options.listenY?this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.scroller.hasVerticalScroll?"block":"none":this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(h.addClass(this.wrapper,"iScrollBothScrollbars"),h.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(h.removeClass(this.wrapper,"iScrollBothScrollbars"),h.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=c.max(c.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"==this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=c.max(c.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var a=this.options.listenX&&c.round(this.sizeRatioX*this.scroller.x)||0,b=this.options.listenY&&c.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(a<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=c.max(this.indicatorWidth+a,8),this.indicatorStyle.width=this.width+"px"),a=this.minBoundaryX):a>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=c.max(this.indicatorWidth-(a-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",a=this.maxPosX+this.indicatorWidth-this.width):a=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),b<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=c.max(this.indicatorHeight+3*b,8),this.indicatorStyle.height=this.height+"px"),b=this.minBoundaryY):b>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=c.max(this.indicatorHeight-3*(b-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",b=this.maxPosY+this.indicatorHeight-this.height):b=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=a,this.y=b,this.scroller.options.useTransform?this.indicatorStyle[h.style.transform]="translate("+a+"px,"+b+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=a+"px",this.indicatorStyle.top=b+"px")},_pos:function(a,b){0>a?a=0:a>this.maxPosX&&(a=this.maxPosX),0>b?b=0:b>this.maxPosY&&(b=this.maxPosY),a=this.options.listenX?c.round(a/this.sizeRatioX):this.scroller.x,b=this.options.listenY?c.round(b/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(a,b)},fade:function(a,b){if(!b||this.visible){clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var c=a?250:500,d=a?0:300;a=a?"1":"0",this.wrapperStyle[h.style.transitionDuration]=c+"ms",this.fadeTimeout=setTimeout(function(a){this.wrapperStyle.opacity=a,this.visible=+a}.bind(this,a),d)}}},d.utils=h,"undefined"!=typeof module&&module.exports?module.exports=d:a.IScroll=d}(window,document,Math);var HA=function(a,b){var c=function(){function c(){}function d(a){var b=a.length,d=c.type(a);return c.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===d||"function"!==d&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}var e={},f=e.toString,g=e.hasOwnProperty;return c.extend=function(){var a,b,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||c.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(b in a)d=h[b],e=a[b],h!==e&&(k&&e&&(c.isPlainObject(e)||(f=c.isArray(e)))?(f?(f=!1,g=d&&c.isArray(d)?d:[]):g=d&&c.isPlainObject(d)?d:{},h[b]=c.extend(k,g,e)):void 0!==e&&(h[b]=e));return h},c.extend({isFunction:function(a){return"function"===c.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?e[f.call(a)]||"object":typeof a},isPlainObject:function(a){if("object"!==c.type(a)||a.nodeType||c.isWindow(a))return!1;try{if(a.constructor&&!g.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}}),c.extend({each:function(a,b){var c,e=0,f=a.length,g=d(a);if(g)for(;f>e&&(c=b.call(a[e],e,a[e]),c!==!1);e++);else for(e in a)if(c=b.call(a[e],e,a[e]),c===!1)break;return a}}),c.extend({event:{ready:"ha:ready",load:"ha:load",save:"ha:save",change:"ha:change",unauthenticated:"ha:unauthenticated",userplay:"ha:userplay",userpause:"ha:userpause",usercurrenttime:"ha:usercurrenttime",userplayword:"ha:userplayword",error:"ha:error"},_commonMethods:{options:{DEBUG:!1,entity:"core"},_trigger:function(a,b){var d=c.extend(!0,{options:this.options},b),e=new CustomEvent(a,{detail:d,bubbles:!0,cancelable:!0});c.gaEvent({type:this.options.entity,action:a+" event: "+(d.msg?d.msg:"")}),this.target.dispatchEvent(e)},_error:function(a){var b={msg:this.options.entity+" Error : "+a};this._trigger(c.event.error,b)},_debug:function(){var a=this;c.each(c.event,function(b,c){a.target.addEventListener(c,function(b){console.log(a.options.entity+" "+c+" event : %o",b)},!1)})}},register:function(a,b){"string"==typeof a&&("function"==typeof b?(b.prototype=c.extend({},this._commonMethods,b.prototype),this[a]=function(a){return new b(a)}):"object"==typeof b&&(b=c.extend({},this._commonMethods,b),this[a]=b))},utility:function(a,b){"string"==typeof a&&(this[a]=b)},getURLParameter:function(b){var c=a.top;try{c.document.createElement("div")}catch(d){c=a}return decodeURIComponent((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)").exec(c.location.search)||[,""])[1].replace(/\+/g,"%20"))||null},gaEvent:function(a){"object"!=typeof a&&(a="string"==typeof a?{type:"message",action:a}:{}),a.origin=a.origin?a.origin:"Hyperaudio Lib",a.type=a.type?a.type:"no type",a.action=a.action?a.action:"no action";var c=new CustomEvent("ga",{detail:a,bubbles:!0,cancelable:!0});b.dispatchEvent(c)},hasClass:function(a,b){if(!a)return!1;var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},addClass:function(a,b){this.hasClass(a,b)||(a.className+=" "+b)},removeClass:function(a,b){if(this.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c," ").replace(/\s{2,}/g," ")}},toggleClass:function(a,b){this.hasClass(a,b)?this.removeClass(a,b):this.addClass(a,b)},empty:function(a){for(;a&&a.firstChild;)a.removeChild(a.firstChild)}}),c}(),d=function(a,b,c){function d(a){this.options={handle:null,dropArea:null,init:!0,touch:!0,mouse:!0,timeout:500,html:"",draggableClass:"",containerTag:"article",blockTag:"section"};for(var c in a)this.options[c]=a[c];this.dropArea="string"==typeof this.options.dropArea?b.querySelector(this.options.dropArea):this.options.dropArea,this.list=this.dropArea.querySelector(this.options.containerTag),this.list||(this.list=b.createElement(this.options.containerTag),this.dropArea.appendChild(this.list)),this.placeholder=b.createElement(this.options.blockTag),this.placeholder.className="placeholder",this.options.init&&(this.handle="string"==typeof this.options.handle?b.querySelector(this.options.handle):this.options.handle,this.handleClassName=this.handle.className,this.reordering=this.handle.parentNode==this.list,this.options.touch&&this.handle.addEventListener("touchstart",this,!1),this.options.mouse&&this.handle.addEventListener("mousedown",this,!1))}return d.prototype.handleEvent=function(a){switch(a.type){case"mousedown":if(1!==a.which)break;case"touchstart":this.start(a);break;case"touchmove":case"mousemove":this.move(a);break;case"touchend":case"mouseup":this.end(a)}},d.prototype.start=function(a){var c=a.touches?a.touches[0]:a,d=a.touches?b.elementFromPoint(c.pageX,c.pageY):c.target;/INPUT/.test(d.tagName)||(a.preventDefault(),this.options.touch&&b.addEventListener("touchend",this,!1),this.options.mouse&&b.addEventListener("mouseup",this,!1),clearTimeout(this.dragTimeout),this.initiated=!1,this.lastTarget=null,this.dragTimeout=setTimeout(this.init.bind(this,this.options.html||this.handle.innerHTML,a),this.options.timeout))},d.prototype.init=function(a,c){this.options.init||(this.options.touch&&b.addEventListener("touchend",this,!1),this.options.mouse&&b.addEventListener("mouseup",this,!1)),this.draggable=b.createElement("div"),this.draggable.className="draggable "+this.options.draggableClass,this.draggableStyle=this.draggable.style,this.draggableStyle.cssText="position:absolute;z-index:1000;pointer-events:none;left:-99999px",this.draggable.innerHTML=a,b.body.appendChild(this.draggable),this.draggableCenterX=Math.round(this.draggable.offsetWidth/2),this.draggableCenterY=Math.round(this.draggable.offsetHeight/2),this.position(c),this.options.touch&&b.addEventListener("touchmove",this,!1),this.options.mouse&&b.addEventListener("mousemove",this,!1),this.initiated=!0,this.reordering&&(this.handle.style.display="none"),this.move(c),this.options.onDragStart&&this.options.onDragStart.call(this)},d.prototype.position=function(a){var b=a.changedTouches?a.changedTouches[0]:a;this.draggableStyle.left=b.pageX-this.draggableCenterX+"px",this.draggableStyle.top=b.pageY-this.draggableCenterY+"px"},d.prototype.move=function(a){a.preventDefault(),a.stopPropagation();var d=a.changedTouches?a.changedTouches[0]:a,e=a.touches?b.elementFromPoint(d.pageX,d.pageY):d.target;if(this.position(a),e!=this.lastTarget&&e!=this.placeholder&&e!=this.list){if(this.lastTarget=e,e==this.dropArea)return void this.list.appendChild(this.placeholder);if(c.hasClass(e,"item")){for(var f=this.list.querySelectorAll(".item"),g=0,h=f.length;h>g;g++)if(e==f[g]){this.list.insertBefore(this.placeholder,f[g]);break}}else this.list.querySelector(".placeholder")&&this.placeholder.parentNode.removeChild(this.placeholder)}},d.prototype.end=function(a){if(clearTimeout(this.dragTimeout),b.removeEventListener("touchend",this,!1),b.removeEventListener("mouseup",this,!1),this.initiated){b.removeEventListener("touchmove",this,!1),b.removeEventListener("mousemove",this,!1);var c=a.changedTouches?a.changedTouches[0]:a,d=(a.touches?b.elementFromPoint(c.pageX,c.pageY):c.target,this.options.html?this.handle.innerHTML:this.draggable.innerHTML);if(this.draggable.parentNode.removeChild(this.draggable),this.draggable=null,!this.list.querySelector(".placeholder"))return this.reordering&&this.handle.parentNode.removeChild(this.handle),void(this.options.onDrop&&this.options.onDrop.call(this,null));var e;this.reordering?(e=this.handle,this.handle.style.display=""):(e=b.createElement(this.options.blockTag),e.className=this.handleClassName||"item",e.innerHTML=d),this.list.insertBefore(e,this.placeholder),this.placeholder.parentNode.removeChild(this.placeholder),this.options.onDrop&&this.options.onDrop.call(this,e)}},d.prototype.destroy=function(){b.removeEventListener("touchstart",this,!1),b.removeEventListener("touchmove",this,!1),b.removeEventListener("touchend",this,!1),b.removeEventListener("mousedown",this,!1),b.removeEventListener("mousemove",this,!1),b.removeEventListener("mouseup",this,!1)},d}(a,b,c),e=function(a){function b(b){this.options={};for(var c in b)this.options[c]=b[c];this.el="string"==typeof this.options.el?a.querySelector(this.options.el):this.options.el,this.stage=this.options.stage||{dropped:function(){}},this.words=this.el.querySelectorAll("a"),this.el.className+=" edit",this.el._tap=new h({el:this.el}),this.el.addEventListener("tap",this,!1),a.addEventListener("touchend",this,!1),a.addEventListener("mouseup",this,!1)}return b.prototype.handleEvent=function(a){switch(a.type){case"touchend":case"mouseup":this.cancel(a);break;case"tap":this.edit(a)}},b.prototype.cancel=function(a){var b=a.target;b!=this.el&&b.parentNode!=this.el&&b.parentNode.parentNode!=this.el&&(c.gaEvent({type:"EDITBLOCK",action:"canceledit: Cancelled editing."}),this.destroy())},b.prototype.edit=function(b){b.stopPropagation();var d,e=b.target,f=this.words.length;if("A"==e.tagName&&e!=this.words[f-1]){var g,h,i=this.el.cloneNode(!1);i.className=i.className.replace(/(^|\s)edit(\s|$)/g," ");for(var j=0;f>j;j++)this.words[j].parentNode!=h&&(g&&d&&g.querySelector("a")&&i.appendChild(g),g=a.createElement("p"),h=this.words[j].parentNode),d&&(g.appendChild(this.words[j]),h.querySelector("a")||h.parentNode.removeChild(h)),d||this.words[j]!=e||(d=!0);i.appendChild(g);var k=a.createElement("div");k.className="actions",i.appendChild(k),this.el.parentNode.insertBefore(i,this.el.nextSibling),this.el.handleHTML=this.el.innerHTML,this.stage.dropped(i),c.gaEvent({type:"EDITBLOCK",action:"edit: Editted section."}),this.destroy()}},b.prototype.destroy=function(){this.el.className=this.el.className.replace(/(^|\s)edit(\s|$)/g," "),a.removeEventListener("touchend",this,!1),a.removeEventListener("mouseup",this,!1),this.el.removeEventListener("tap",this,!1),this.el._editBlock=null,this.el._tap.destroy(),this.el._tap=null},b}(b),f=function(a,b){function c(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}function d(a){var b={time:2e3,background:"#000000",color:"#ffffff",text:"",fadeOut:!1,fadeIn:!1,outFirst:!0};for(var c in a)b[c]=a[c];return i=new e(b)}function e(a){this.options=a,this.servo=b.getElementById("fxHelper"),this.servo.querySelector("div").innerHTML=this.options.text?this.options.text:"",this.servo.style[h]="opacity 0ms",this.servo.style.left="0px",this.servo.style.backgroundColor=this.options.background,this.servo.style.color=this.options.color,this.options.fadeOut?(this.servo.style.opacity="0",this.fadeOut()):this.options.fadeIn&&(this.servo.style.opacity="1",this.fadeIn())}{var f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransition",a in f)return b[c].substr(0,b[c].length-1);return!1}(),h=c("transition");c("transform")}f=null;var i;return e.prototype.handleEvent=function(a){switch(a.type){case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this.transitionEnd(a)}},e.prototype.fadeOut=function(){this.phase="fadeOut",this.servo.addEventListener("transitionend",this,!1),this.servo.addEventListener("webkitTransitionEnd",this,!1),this.servo.addEventListener("oTransitionEnd",this,!1),this.servo.addEventListener("MSTransitionEnd",this,!1);this.servo.offsetHeight;this.servo.style[h]="opacity "+this.options.time+"ms";var a=this;setTimeout(function(){a.servo.style.opacity="1"},0)},e.prototype.transitionEnd=function(a){a.stopPropagation(),this.servo.removeEventListener("transitionend",this,!1),this.servo.removeEventListener("webkitTransitionEnd",this,!1),this.servo.removeEventListener("oTransitionEnd",this,!1),this.servo.removeEventListener("MSTransitionEnd",this,!1),"fadeOut"==this.phase?this.options.onFadeOutEnd&&this.options.onFadeOutEnd.call(this):"fadeIn"==this.phase&&this.options.onFadeInEnd&&this.options.onFadeInEnd.call(this)},e.prototype.fadeIn=function(){this.phase="fadeIn",this.servo.addEventListener("transitionend",this,!1),this.servo.addEventListener("webkitTransitionEnd",this,!1),this.servo.addEventListener("oTransitionEnd",this,!1),this.servo.addEventListener("MSTransitionEnd",this,!1);this.servo.offsetHeight;this.servo.style[h]="opacity "+this.options.time+"ms";var a=this;setTimeout(function(){a.servo.style.opacity="0"},0)},e.prototype.destroy=function(){this.servo.removeEventListener("transitionend",this,!1),this.servo.removeEventListener("webkitTransitionEnd",this,!1),this.servo.removeEventListener("oTransitionEnd",this,!1),this.servo.removeEventListener("MSTransitionEnd",this,!1),this.servo.style[h]="opacity 0ms",this.servo.style.opacity="0",this.servo.style.left="-9999px",i=null},d}(a,b),g=function(a,b){function c(b){this.options={el:"#sidemenu",transcripts:"#panel-media",music:"#panel-bgm",stage:null};for(var c in b)this.options[c]=b[c];this.el="string"==typeof this.options.el?a.querySelector(this.options.el):this.options.el,this.transcripts="string"==typeof this.options.transcripts?a.querySelector(this.options.transcripts):this.options.transcripts,this.music="string"==typeof this.options.music?a.querySelector(this.options.music):this.options.music,this.mediaCallback=this.options.callback;var d=a.querySelector("#sidemenu-handle");d._tap=new h({el:d}),d.addEventListener("tap",this.toggleMenu.bind(this),!1),this.updateStatus();var e=a.querySelectorAll("#sidemenu .tabbar li");for(c=e.length-1;c>=0;c--)e[c]._tap=new h({el:e[c]}),e[c].addEventListener("tap",this.selectPanel.bind(this),!1);this.initTranscripts(),this.initMusic()}var e="on-demand",f="owned-by-user",g="user-media",i="other-media",j="Other...",k="nochannel",l="empty";return c.prototype.makeMenuFolder=function(c,d,f,g){var h=a.createElement("li"),i=a.createElement("div"),j=a.createElement("ul");return b.addClass(h,"folder"),f&&(b.addClass(h,e),h.setAttribute("data-channel",f),g&&h.setAttribute("data-user","1")),i.innerHTML=d,h.appendChild(i),h.appendChild(j),c.appendChild(h),j},c.prototype.makeMenuItem=function(b,c){var d=a.createElement("li");return c&&d.setAttribute("data-id",c),d.innerHTML=b,d},c.prototype.initTranscripts=function(){var a,c,d,m,n,o,p,q=this,r="";a=function(){b.api.getUsername(function(a){a&&(r=this.username,r?d():c())})},d=function(){b.api.getChannels({user:!0,callback:function(a){a&&n(a)}})},c=function(){b.api.getChannels({callback:function(a){a&&m(a)}})},n=function(a){var d=q.makeMenuFolder(q.transcripts,"Your Media");if(b.addClass(d,g),a&&a.length)for(var e=0,f=a.length;f>e;e++)q.makeMenuFolder(d,a[e],a[e],!0);q.makeMenuFolder(d,j,k,!0),c()},m=function(a){var c=q.makeMenuFolder(q.transcripts,"Media");if(b.addClass(c,i),a&&a.length)for(var d=0,e=a.length;e>d;d++)q.makeMenuFolder(c,a[d],a[d],!1);q.makeMenuFolder(c,j,k,!1),q.transcripts._tap=new h({el:q.transcripts}),q.transcripts.addEventListener("tap",o,!1)},o=function(a){a.stopPropagation();var c=a.target,d=q.toggleFolder(a);if(d)return void(q.isOnDemand(d)&&(b.removeClass(d,e),p(d)));var f=c.getAttribute("data-id");f&&q.mediaCallback&&(b.Address.setParam("t",f),q.mediaCallback(c))},p=function(a){var c=a.getAttribute("data-channel"),d=!!a.getAttribute("data-user");a=a.querySelector("ul"),b.api.getTranscripts({user:d,channel:c,callback:function(c){var d,g;if(c)if(c.length)for(var h=0,i=c.length;i>h;h++)d=c[h],g=q.makeMenuItem(d.label,d._id),r&&d.owner===r&&b.addClass(g,f),a.appendChild(g);else a.appendChild(q.makeMenuItem(l));else b.addClass(a,e)}})},a()},c.prototype.initMusic=function(){function c(){b.addClass(g.target,"dragdrop"),b.gaEvent({type:"SIDEMENU",action:"bgmstartdrag: Began dragging BGM effect"})}function e(a){if(b.removeClass(g.target,"dragdrop"),a){var c=a.innerHTML;b.addClass(a,"effect"),a.setAttribute("data-effect","bgm");var d=this.handle.getAttribute("data-id"),e=this.handle.getAttribute("data-mp3"),f=this.handle.getAttribute("data-mp4"),h=this.handle.getAttribute("data-ogg");d&&a.setAttribute("data-id",d),e&&a.setAttribute("data-mp3",e),f&&a.setAttribute("data-mp4",f),h&&a.setAttribute("data-ogg",h);var i='<form><div><span class="icon-music">'+c+'</span></div><label>Delay: <span class="value">0</span>s</label><input id="effect-delay" type="range" value="0" min="0" max="30" step="0.5" onchange="this.setAttribute(\'value\', this.value); this.previousSibling.querySelector(\'span\').innerHTML = this.value"><label>Start At: <span class="value">0</span>s</label><input id="effect-start" type="range" value="0" min="0" max="30" step="0.5" onchange="this.setAttribute(\'value\', this.value); this.previousSibling.querySelector(\'span\').innerHTML = this.value"><label>Duration: <span class="value">60</span>s</label><input id="effect-duration" type="range" value="60" min="0" max="120" step="0.5" onchange="this.setAttribute(\'value\', this.value); this.previousSibling.querySelector(\'span\').innerHTML = this.value"><label>Volume: <span class="value">80</span>%</label><input id="effect-volume" type="range" value="80" min="10" max="100" step="5" onchange="this.setAttribute(\'value\', this.value); this.previousSibling.querySelector(\'span\').innerHTML = this.value"></form>';a.innerHTML=i,g.dropped(a,'<span class="icon-music">'+c+"</span>"),b.gaEvent({type:"SIDEMENU",action:"bgmdrop: Dropped BGM effect on to stage"})}}var f=this,g=this.options.stage;g.target&&b.api.getBGM(function(b){if(b){for(var i,j,k=0,l=this.bgm.length;l>k;k++)j=this.bgm[k],"audio"===j.type&&(i=a.createElement("li"),i.setAttribute("data-id",j._id),j.source.mp3&&i.setAttribute("data-mp3",j.source.mp3.url),j.source.mp4&&i.setAttribute("data-mp4",j.source.mp4.url),j.source.ogg&&i.setAttribute("data-ogg",j.source.ogg.url),i.innerHTML=j.label,i._dragInstance=new d({handle:i,html:'<span class="icon-music">'+j.label+"</span>",dropArea:g.target,draggableClass:"draggableEffect",onDragStart:c,onDrop:e}),f.music.appendChild(i));f.music._tap=new h({el:f.music}),f.music.addEventListener("tap",f.toggleFolder.bind(f),!1)}})},c.prototype.updateStatus=function(){this.opened=b.hasClass(this.el,"opened")},c.prototype.toggleMenu=function(){var a;this.opened?(this.close(),a="Closed"):(this.open(),a="Opened"),b.gaEvent({type:"SIDEMENU",action:"togglemenu: "+a})},c.prototype.open=function(){this.opened||(b.addClass(this.el,"opened"),this.opened=!0)},c.prototype.close=function(){this.opened&&(b.removeClass(this.el,"opened"),this.opened=!1)},c.prototype.selectPanel=function(c){var d=a.querySelector("#sidemenu .tabbar li.selected"),e=c.currentTarget;b.removeClass(d,"selected"),b.addClass(e,"selected");var f="panel"+e.id.replace("sidemenu","");d=a.querySelector("#sidemenu .panel.selected"),b.removeClass(d,"selected"),e=a.querySelector("#"+f),b.addClass(e,"selected");var g=c.currentTarget.querySelector("span").innerHTML;b.gaEvent({type:"SIDEMENU",action:"selectpanel: Switched tab -> "+g})},c.prototype.selectMedia=function(a){a.stopPropagation();var b=a.target;return this.toggleFolder(a)?void this.isOnDemand(a):void(b.getAttribute("data-id")&&this.mediaCallback&&this.mediaCallback(b))},c.prototype.isOnDemand=function(a){return b.hasClass(a.parentNode,e)&&(a=a.parentNode),b.hasClass(a,e)?a:!1},c.prototype.isFolder=function(a){return b.hasClass(a.parentNode,"folder")&&(a=a.parentNode),b.hasClass(a,"folder")?a:!1},c.prototype.toggleFolder=function(a){var c=this.isFolder(a.target);if(c){b.toggleClass(c,"open");var d=c.querySelector("div").innerHTML;return b.gaEvent({type:"SIDEMENU",action:"togglefolder: "+(b.hasClass(c,"open")?"Opened":"Closed")+" -> "+d}),c}return!1},c}(b,c),h=function(a,b,c){function d(a){this.options={};for(var c in a)this.options[c]=a[c];this.el="string"==typeof this.options.el?b.querySelector(this.options.el):this.options.el,this.el.addEventListener("touchstart",this,!1),this.el.addEventListener("mousedown",this,!1)}return d.prototype={handleEvent:function(a){switch(a.type){case"mousedown":if(1!==a.which)break;case"touchstart":this._start(a);break;case"touchmove":case"mousemove":this._move(a);break;case"touchend":case"mouseup":case"touchcancel":case"mousecancel":this._end(a)}},_start:function(a){if(!(a.touches&&a.touches.length>1)){a.preventDefault();var b=a.touches?a.touches[0]:a;this.moved=!1,this.startX=b.pageX,this.startY=b.pageY,this.target=a.target,c.addClass(this.target,"tapPressed"),this.el.addEventListener("touchmove",this,!1),this.el.addEventListener("touchend",this,!1),this.el.addEventListener("touchcancel",this,!1),this.el.addEventListener("mousemove",this,!1),this.el.addEventListener("mouseup",this,!1),this.el.addEventListener("mousecancel",this,!1)}},_move:function(a){var b=a.changedTouches?a.changedTouches[0]:a,d=b.pageX,e=b.pageY;(Math.abs(d-this.startX)>10||Math.abs(e-this.startY)>10)&&(c.removeClass(this.target,"tapPressed"),this.moved=!0)},_end:function(a){if(c.removeClass(this.target,"tapPressed"),!this.moved){var d=b.createEvent("Event"),e=a.changedTouches?a.changedTouches[0]:a;d.initEvent("tap",!0,!0),d.pageX=e.pageX,d.pageY=e.pageY,this.target.dispatchEvent(d)}this.el.removeEventListener("touchmove",this,!1),this.el.removeEventListener("touchend",this,!1),this.el.removeEventListener("touchcancel",this,!1),this.el.removeEventListener("mousemove",this,!1),this.el.removeEventListener("mouseup",this,!1),this.el.removeEventListener("mousecancel",this,!1)},destroy:function(){this.el.removeEventListener("touchstart",this,!1),this.el.removeEventListener("touchmove",this,!1),this.el.removeEventListener("touchend",this,!1),this.el.removeEventListener("touchcancel",this,!1),this.el.removeEventListener("mousedown",this,!1),this.el.removeEventListener("mousemove",this,!1),this.el.removeEventListener("mouseup",this,!1),this.el.removeEventListener("mousecancel",this,!1)}},d}(a,b,c),i=function(a,b){function c(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}function d(a){if(!j){var b={el:null,text:"",speed:600,duration:3e3,background:"rgba(0,0,0,0.8)",color:"#ffffff"};for(var c in a)b[c]=a[c];j=new e(b)}return j}function e(a){this.options=a,this.el="string"==typeof this.options.el?b.querySelector(this.options.el):this.options.el,this.el.innerHTML=this.options.text,this.el.style.backgroundColor=this.options.background,this.el.style.color=this.options.color,this.el.style.left="0px",this.el.style[i]="translate(0, 100%) translateZ(0)",this.el.addEventListener("transitionend",this,!1),this.el.addEventListener("webkitTransitionEnd",this,!1),this.el.addEventListener("oTransitionEnd",this,!1),this.el.addEventListener("MSTransitionEnd",this,!1),this.start()}var f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in f)return b[c].substr(0,b[c].length-1);return!1}(),h=(c("transition"),c("transitionDuration")),i=c("transform");f=null;var j;return e.prototype.handleEvent=function(a){switch(a.type){case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this.transitionEnd(a)}},e.prototype.start=function(){this.phase="start";this.el.offsetHeight;this.el.style[h]=this.options.speed+"ms";var a=this;setTimeout(function(){a.el.style[i]="translate(0, 0) translateZ(0)"},0)},e.prototype.transitionEnd=function(a){return a.stopPropagation(),"start"==this.phase?(this.phase="waiting",void(this.timeout=setTimeout(this.end.bind(this),this.options.duration))):(this.options.onEnd&&this.options.onEnd.call(this),void this.destroy())},e.prototype.end=function(){this.phase="end",this.el.style[i]="translate(0, 100%) translateZ(0)"},e.prototype.destroy=function(){clearTimeout(this.timeout),this.el.removeEventListener("transitionend",this,!1),this.el.removeEventListener("webkitTransitionEnd",this,!1),this.el.removeEventListener("oTransitionEnd",this,!1),this.el.removeEventListener("MSTransitionEnd",this,!1),this.el.style[h]="0s",this.el.style.left="-9999px",j=null},d}(a,b),j=function(a,b,c){function d(a){var b=(a.innerText||a.textContent).split(" ");a.innerHTML="<a>"+b.join(" </a><a>")+"</a>"}function e(a){this.options={el:null,addHelpers:!1,touch:!0,mouse:!0,threshold:10,timeout:0};for(var c in a)this.options[c]=a[c];this.element="string"==typeof this.options.el?b.querySelector(this.options.el):this.options.el,this.options.addHelpers&&d(this.element),this.words=this.element.querySelectorAll("a"),this.wordsCount=this.words.length,this.options.touch&&this.element.addEventListener("touchstart",this,!1),this.options.mouse&&this.element.addEventListener("mousedown",this,!1)}return e.prototype.handleEvent=function(a){switch(a.type){case"mousedown":if(1!==a.which)break;case"touchstart":this.start(a);break;case"touchmove":case"mousemove":this.move(a);break;case"touchend":case"mouseup":this.end(a)}},e.prototype.start=function(b){b.preventDefault();b.touches?b.touches[0]:b;this.selectStarted=!1,this.startX=b.pageX,this.startY=b.pageY,this.options.mouse&&(this.element.addEventListener("mousemove",this,!1),a.addEventListener("mouseup",this,!1)),this.options.touch&&(this.element.addEventListener("touchmove",this,!1),a.addEventListener("touchend",this,!1)),c.hasClass(b.target,"selected")&&(this.dragTimeout=setTimeout(this.dragStart.bind(this,b),this.options.timeout))},e.prototype.selectStart=function(a){var b,d=a.target;if(d!=this.element&&"A"==d.tagName){if(this.selectStarted=!0,this.currentWord=d,this.words[this.startPosition]===d)return b=this.startPosition,this.startPosition=this.endPosition,void(this.endPosition=b);if(this.words[this.endPosition]!==d){for(var e=0;e<this.wordsCount;e++)this.words[e]==d&&(this.startPosition=e),c.removeClass(this.words[e],"selected");this.endPosition=this.startPosition,c.addClass(d,"selected")}}},e.prototype.move=function(a){var d,e=a.changedTouches?a.changedTouches[0]:a,f=a.touches?b.elementFromPoint(e.pageX,e.pageY):e.target;if(!(Math.abs(e.pageX-this.startX)<this.options.threshold&&Math.abs(e.pageY-this.startY)<this.options.threshold)){if(clearTimeout(this.dragTimeout),!this.selectStarted)return void this.selectStart(a);if("P"==f.tagName&&(f=f.querySelector("a:last-child")),f!=this.element&&f!=this.currentWord&&"A"==f.tagName){for(var g=0;g<this.wordsCount;g++)this.words[g]==f&&(d=g),void 0===d&&g>=this.startPosition||void 0!==d&&g<=this.startPosition||d==g?c.addClass(this.words[g],"selected"):c.removeClass(this.words[g],"selected");this.currentWord=f,this.endPosition=d}}},e.prototype.end=function(a){if(clearTimeout(this.dragTimeout),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)),!this.selectStarted)return void(a.target==this.element&&this.clearSelection());Math.min(this.startPosition,this.endPosition),Math.max(this.startPosition,this.endPosition);this.options.onSelection&&this.options.onSelection.call(this)},e.prototype.clearSelection=function(){this.currentWord=null,this.startPosition=null,this.endPosition=null,this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1));for(var a=this.element.querySelectorAll(".selected"),b=0,d=a.length;d>b;b++)c.removeClass(a[b],"selected");this.options.onClear&&this.options.onClear.call(this)},e.prototype.getSelection=function(){for(var a,b=this.element.querySelectorAll(".selected"),c="",d=0,e=b.length;e>d;d++)b[d].parentNode!==a&&(a=b[d].parentNode,c+=0===d?"<p>":"</p><p>"),c+=b[d].outerHTML.replace(/ class="[\d\w\s\-]*\s?"/gi," ");return c&&(c+="</p>"),c},e.prototype.dragStart=function(a){a.stopPropagation(),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1));a.changedTouches?a.changedTouches[0]:a;this.options.onDragStart&&this.options.onDragStart.call(this,a)},e.prototype.destroy=function(){this.element.removeEventListener("touchstart",this,!1),this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1),this.element.removeEventListener("mousedown",this,!1),this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)},e}(a,b,c),k=function(a){return function(b){b=a.extend({url:"",data:"",type:"GET",responseType:"",async:!0,withCredentials:!0,timeout:0,cache:!0},b),b.cache||(b.url=b.url+(/\?/.test(b.url)?"&":"?")+(new Date).getTime());var c=new XMLHttpRequest;return c.addEventListener("load",function(a){200<=this.status&&this.status<300?"function"==typeof b.complete&&b.complete.call(this,a):"function"==typeof b.error&&b.error.call(this,a)},!1),"function"==typeof b.error&&(c.addEventListener("error",function(a){b.error.call(this,a)},!1),c.addEventListener("abort",function(a){b.error.call(this,a)},!1)),c.open(b.type,b.url,b.async),c.responseType=b.responseType,c.withCredentials=b.withCredentials,c.timeout=b.timeout,b.data&&c.setRequestHeader("content-type","application/json; charset=utf-8"),c.send(b.data),c}}(c),l=function(a){return{init:function(b){this.options=a.extend({protocol:"http://",org:"",api:"api.",domain:"hyperaud.io",version:"/v1/",transcripts:"transcripts/",transcripts_filter:"?type=html",mixes:"mixes/",channels:"channels/",signin:"login/",whoami:"whoami/",bgm:"bgm/media/"},b),this.url=null,this._updateInternals(),this.error=!1,this.guest=!1,this.username="",this.transcripts=null,this.transcript=null,this.mixes=null,this.mix=null,this.bgm=null,this.channels=null},option:function(b,c){if("string"==typeof b){if("undefined"==typeof c)return this.options[b];this.options[b]=c}else{if("object"!=typeof b)return a.extend({},this.options);a.extend(this.options,b)}this._updateInternals()},_updateInternals:function(){var a=this.options.org?this.options.org+".":"";this.url=this.options.protocol+a+this.options.api+this.options.domain+this.options.version},callback:function(a,b){"function"==typeof a&&a.call(this,b)},signin:function(b,c){var d=this;k({url:this.url+this.options.signin,type:"POST",data:JSON.stringify(b),complete:function(){var b=JSON.parse(this.responseText);d.guest=!b.user,d.guest?(d.username="",d.callback(c,!1)):(d.username=b.user,a.gaEvent({type:"API",action:"login: User signed in"}),d.callback(c,!0))},error:function(){d.error=!0,d.callback(c,!1)}})},getUsername:function(a,b){var c=this;b||!this.guest&&!this.username?k({url:this.url+this.options.whoami,complete:function(){var b=JSON.parse(this.responseText);c.guest=!b.user,c.username=c.guest?"":b.user,c.callback(a,!0)},error:function(){c.error=!0,c.callback(a,!1)}}):setTimeout(function(){c.callback(a,!0)},0)},getChannels:function(b){var c,d,e,f=this;b=a.extend({user:!1,callback:null},b),c=function(){f.getUsername(function(a){a&&!f.guest?e():f.callback(b.callback,!1)})},d=function(){var a=f.url;return b.user&&(a+=f.username+"/"),a+=f.options.transcripts+f.options.channels},e=function(){k({url:d(),complete:function(){var a=JSON.parse(this.responseText);f.callback(b.callback,a)},error:function(){f.error=!0,f.callback(b.callback,!1)}})},b.user?c():e()},getTranscripts:function(b){var c,d,e,f=this;b=a.extend({user:!1,channel:"",callback:null},b),c=function(){f.getUsername(function(a){a&&!f.guest?e():f.callback(b.callback,!1)})},d=function(){var a=f.url;return b.user&&(a+=f.username+"/"),a+=f.options.transcripts,b.channel&&(a+=f.options.channels+b.channel),a+=f.options.transcripts_filter},e=function(){k({url:d(),complete:function(){var a=JSON.parse(this.responseText);f.callback(b.callback,a)},error:function(){f.error=!0,f.callback(b.callback,!1)}})},b.user?c():e()},getTranscriptsOLD:function(a,b){var c=this;!b&&this.transcripts?setTimeout(function(){c.callback(a,!0)},0):k({url:this.url+this.options.transcripts,complete:function(){var b=JSON.parse(this.responseText);c.transcripts=b,c.callback(a,!0)},error:function(){c.error=!0,c.callback(a,!1)}})},getTranscript:function(a,b,c){var d=this;!c&&this.transcript&&this.transcript._id===a?setTimeout(function(){d.callback(b,!0)},0):this.getUsername(function(c){c&&a?k({url:d.url+d.options.transcripts+a,complete:function(){var a=JSON.parse(this.responseText);d.transcript=a,d.callback(b,!0)},error:function(){d.error=!0,d.callback(b,!1)}}):(d.error=!0,d.callback(b,!1))})},getMixes:function(a,b){var c=this;!b&&this.mixes?setTimeout(function(){c.callback(a,!0)},0):this.getUsername(function(b){b?k({url:c.url+(c.guest?"":c.username+"/")+c.options.mixes,complete:function(){var b=JSON.parse(this.responseText);c.mixes=b,c.callback(a,!0)},error:function(){c.error=!0,c.callback(a,!1)}}):(c.error=!0,c.callback(a,!1))})},getMix:function(a,b,c){var d=this;!c&&this.mix&&this.mix._id===a?setTimeout(function(){d.callback(b,!0)},0):this.getUsername(function(c){c&&a?k({url:this.url+(this.guest?"":this.username+"/")+this.options.mixes+a,complete:function(){var a=JSON.parse(this.responseText);d.mix=a,d.callback(b,!0)},error:function(){d.error=!0,d.callback(b,!1)}}):(d.error=!0,d.callback(b,!1))})},putMix:function(a,b){var c=this;if("object"==typeof a){var d="POST",e="";this.getUsername(function(f){f&&!c.guest&&c.username?(c.mix&&c.mix._id&&c.mix._id===a._id&&c.username===a.owner&&(d="PUT",e=c.mix._id),k({url:c.url+c.username+"/"+c.options.mixes+e,type:d,data:JSON.stringify(a),complete:function(){var a=JSON.parse(this.responseText);c.mix=a,c.callback(b,{saved:!0})},error:function(){c.error=!0,c.callback(b,!1)}})):f?c.callback(b,{needLogin:!0}):c.callback(b,!1)},!0)}else setTimeout(function(){c.callback(b,!1)},0)},getBGM:function(a,b){var c=this;!b&&this.bgm?setTimeout(function(){c.callback(a,!0)},0):k({url:this.url+this.options.bgm,complete:function(){var b=JSON.parse(this.responseText);c.bgm=b,c.callback(a,!0)},error:function(){c.error=!0,c.callback(a,!1)}})}}}(c),m=function(c){var d=!1;return{init:function(d){var e=this;this.options=c.extend({target:"body",id_container:"clipboard-container",id_clipboard:"clipboard"},d),this.value="",this.target="string"==typeof this.options.target?b.querySelector(this.options.target):this.options.target,this.target&&(this.container=b.createElement("div"),this.container.setAttribute("id",this.options.id_container),this.container.style.display="none",this.target.appendChild(this.container));var f=!0;try{a.top.document.createElement("div")}catch(g){f=!1}f&&(a.top.document.documentElement.addEventListener("keydown",function(a){e.onKeyDown(a)},!1),a.top.document.documentElement.addEventListener("keyup",function(a){e.onKeyUp(a)},!1)),b.documentElement.addEventListener("keydown",function(a){e.onKeyDown(a)},!1),b.documentElement.addEventListener("keyup",function(a){e.onKeyUp(a)},!1),this.enable()},enable:function(a){a="undefined"==typeof a?!0:!!a,this.enabled=a},disable:function(a){a="undefined"==typeof a?!0:!!a,this.enable(!a)},copy:function(a){this.value=a},clear:function(){this.value=""},onKeyDown:function(a){if(d&&console.log("[onKeyDown] : Key pressed"),!this.enabled||!this.value||!a.ctrlKey&&!a.metaKey)return void(d&&console.log("[onKeyDown] : Exit | enabled = "+this.enabled+' | value = "'+this.value+'"'));var e=b.activeElement,f="A INPUT TEXTAREA SELECT BUTTON",g=!1;"undefined"!=typeof e?null!==e&&"BODY"!==e.nodeName.toUpperCase()&&(g=!0,d&&console.log("[onKeyDown] : Exit | pageFocus = %o"+e)):c.each(f.split(/\s+/g),function(b,c){return a.target.nodeName.toUpperCase()===c.toUpperCase()?(g=!0,d&&console.log("[onKeyDown] : Exit | nodeName = "+c),!1):void 0}),g||(d&&console.log('[onKeyDown] : Textarea prepared for copy | value = "'+this.value+'"'),c.empty(this.container),this.container.style.display="block",this.clipboard=b.createElement("textarea"),this.clipboard.setAttribute("id",this.options.id_clipboard),this.clipboard.value=this.value,this.container.appendChild(this.clipboard),this.clipboard.focus(),this.clipboard.select())},onKeyUp:function(a){d&&console.log("[onKeyUp] : Key released"),a.target===this.clipboard&&(c.empty(this.container),this.container.style.display="none")}}}(c),n=function(c){var d=!0;return{init:function(e){this.options=c.extend({title:"Hyperaudio Pad"},e),this.enabled=!1,this.status={iframe:!1,remote:!1,support:!1};try{a.top.document.createElement("div"),a.top.document!==b&&(this.status.iframe=!0)}catch(f){this.status.iframe=!0,this.status.remote=!0}this.win=this.status.remote||!this.status.iframe?a:a.top,this.win.history&&this.win.history.replaceState&&(this.status.support=!0),d&&console.log("[History|init] status: { iframe: "+this.status.iframe+", remote: "+this.status.remote+", support: "+this.status.support+" }"),this.enable()},enable:function(){return this.status.support&&(this.enabled=!0),this.enabled},disable:function(){this.enabled=!1},getUrlDetail:function(){var a=this.win.document.location.href,b=a,c=a.indexOf("?"),d="",e=a.indexOf("#"),f="";c>=0?(b=a.slice(0,c),e>=0?(d=a.slice(c+1,e),f=a.slice(e+1)):d=a.slice(c+1)):e>=0&&(b=a.slice(0,e),f=a.slice(e+1));for(var g,h=d.split("&"),i={},j=0,k=h.length;k>j;j++)g=h[j].split("="),2===g.length&&(i[g[0]]=g[1]);return{base:b,param:i,hash:f}},buildUrl:function(a){var b=!0,c=a.base;for(var e in a.param)a.param.hasOwnProperty(e)&&(b?(b=!1,c+="?"):c+="&",c+=e+"="+a.param[e]);return a.hash&&(c+="#"+a.hash),d&&console.log('[History|buildUrl] href = "'+c+'"'),c},setParam:function(a,b){if(this.enabled){var c=this.getUrlDetail(),e=!1;"string"==typeof b?c.param[a]!==b&&(c.param[a]=b,e=!0,d&&console.log('[History|setParam] NEW VALUE | "'+a+'" = "'+b+'"')):"undefined"!=typeof c.param[a]&&(delete c.param[a],e=!0,d&&console.log('[History|setParam] DELETE VALUE | "'+a+'" = "'+b+'"')),e&&this.win.history.replaceState(null,this.options.title,this.buildUrl(c))}},getParam:function(a){if(this.enabled){var b=this.getUrlDetail();return b.param[a]}}}}(c),o=function(a,b,c,d){function e(d){this.options=c.extend({},this.options,{entity:"MUSIC",target:"#music-player",media:{mp3:"",mp4:"",ogg:""},mediaType:{mp3:"audio/mpeg",mp4:"audio/mp4",ogg:"audio/ogg"},async:!0},d),this.effect={start:0,duration:6,volume:1,fadeInDuration:2,fadeOutDuration:2,media:{}},this.target="string"==typeof this.options.target?b.querySelector(this.options.target):this.options.target,this.audioElem=null,this.timeout={},this.commandsIgnored=/ipad|iphone|ipod|android/i.test(a.navigator.userAgent),this.mediaTypes="mp3 mp4 ogg",this.options.DEBUG&&this._debug(),this.target&&this.create()}return e.prototype={create:function(){var a=this;if(this.target){this.audioElem=b.createElement("audio"),this.audioElem.addEventListener("progress",function(){this.readyState>0&&(a.commandsIgnored=!1)},!1),this.empty(this.target),this.target.appendChild(this.audioElem);var c=function(b){a.manager(this,b)};this.audioElem.addEventListener("progress",c),this.audioElem.addEventListener("timeupdate",c),this.audioElem.addEventListener("play",c),this.audioElem.addEventListener("pause",c),this.audioElem.addEventListener("ended",c),(this.options.media.mp3||this.options.media.mp4)&&this.load()}else this._error("Target not found : "+this.options.target)},mediaDiff:function(a){var b=this,d=!1;return a?c.each(this.mediaTypes.split(/\s+/g),function(){return b.options.media[this]!==a[this]?(d=!0,!1):void 0}):d=!0,d},load:function(a){var d=this,e=this.mediaDiff(a);a&&(this.options.media=a),this.target?e&&(this.pause(),this.killPopcorn(),this.empty(this.audioElem),c.each(this.options.media,function(a,c){if(d.options.mediaType[a]&&c){var e=b.createElement("source");e.setAttribute("type",d.options.mediaType[a]),e.setAttribute("src",c),d.audioElem.appendChild(e)}}),this.audioElem.load(),this.initPopcorn()):this._error("Video player not created : "+this.options.target)},initPopcorn:function(){this.killPopcorn(),this.popcorn=d(this.audioElem)},killPopcorn:function(){this.popcorn&&(this.popcorn.destroy(),delete this.popcorn)},empty:function(a){for(;a&&a.firstChild;)a.removeChild(a.firstChild)},play:function(a){this.currentTime(a,!0)},pause:function(a){this.audioElem.pause(),this.currentTime(a)},currentTime:function(a,b){var c=this,d=this.audioElem;if(clearTimeout(this.timeout.currentTime),"number"!=typeof a||isNaN(a))b&&d.play();else{b&&this.commandsIgnored&&d.play();try{if(d.seekable&&!("object"==typeof d.seekable&&d.seekable.length>0))throw 1;d.currentTime=a,b&&d.play()}catch(e){this.timeout.currentTime=setTimeout(function(){c.currentTime(a,b)},250)}}},manager:function(a){if(this.paused=a.paused,!this.paused){{var b=this.effect.start+this.effect.duration;({start:this.effect.start,end:this.effect.start+this.effect.fadeInDuration}),{start:b-this.effect.fadeOutDuration,end:b}}a.currentTime>b&&this.pause()}},bgmFX:function(a){c.extend(this.effect,a),this.load(this.effect.media),this.audioElem.volume=this.effect.volume,this.play(this.effect.start)}},e}(a,b,c,Popcorn),p=function(a,b,c,d){function e(d){this.options=c.extend({},this.options,{entity:"PLAYER",target:"#transcript-video",cache:!1,media:{youtube:"",mp4:"",webm:""},mediaType:{mp4:"video/mp4",webm:"video/webm",mpeg:"audio/mpeg"},guiNative:!1,gui:!1,cssClass:"hyperaudio-player",solutionClass:"solution",async:!0},d),this.target="string"==typeof this.options.target?b.querySelector(this.options.target):this.options.target,this.videoElem=null,this.timeout={},this.commandsIgnored=/ipad|iphone|ipod|android/i.test(a.navigator.userAgent),this.mediaTypes="youtube mp4 webm",this.youtube=!1,this.ytFix=[],this.options.DEBUG&&this._debug(),this.target&&this.create()}return e.prototype={create:function(){var a=this,e=!1;if(this.target){if(this.wrapper={html:b.createElement("div"),youtube:b.createElement("div")},c.addClass(this.wrapper.html,this.options.cssClass+"-video-wrapper"),c.addClass(this.wrapper.youtube,this.options.cssClass+"-youtube-wrapper"),this.solution={html:b.createElement("video"),youtube:d.HTMLYouTubeVideoElement(this.wrapper.youtube)},this.videoElem=this.solution.html,this.youtube=!1,this.updateSolution(),this.solution.html.controls=this.options.guiNative,this.solution.html.addEventListener("progress",function(){this.readyState>0&&(a.commandsIgnored=!1)},!1),this.empty(this.target),this.wrapper.html.appendChild(this.solution.html),this.target.appendChild(this.wrapper.html),this.target.appendChild(this.wrapper.youtube),this.options.gui){var f={player:this,navigation:!1,fullscreen:!1,cssClass:this.options.cssClass};"object"==typeof this.options.gui&&c.extend(f,this.options.gui),this.GUI=new c.PlayerGUI(f);var g=function(){var b=a.videoElem;a.GUI.setStatus({paused:b.paused,currentTime:b.currentTime,duration:b.duration})};this.addEventListener("progress",g),this.addEventListener("timeupdate",g),this.addEventListener("play",g),this.addEventListener("pause",g),this.addEventListener("ended",g)}c.each(this.options.media,function(a,b){return b?(e=!0,!1):void 0}),e&&this.load()}else this._error("Target not found : "+this.options.target)},mediaDiff:function(a){var b=this,d=!1;return a?c.each(this.mediaTypes.split(/\s+/g),function(){return b.options.media[this]!==a[this]?(d=!0,!1):void 0}):d=!0,d},updateSolution:function(){var a=this.wrapper,b=this.options.solutionClass;this.youtube?(c.removeClass(a.html,b),c.addClass(a.youtube,b)):(c.removeClass(a.youtube,b),c.addClass(a.html,b))},show:function(){this.updateSolution()},hide:function(){var a=this.wrapper,b=this.options.solutionClass;c.removeClass(a.html,b),c.removeClass(a.youtube,b)},load:function(a){var d=this,e=this.mediaDiff(a);a&&(this.options.media=a),this.target?e&&(this.pause(),this.killPopcorn(),this.options.media.youtube?(this.solution.youtube.src=this.options.media.youtube+"&html5=1",this.videoElem=this.solution.youtube,this.youtube=!0,this.updateSolution()):(this.empty(this.solution.html),c.each(this.options.media,function(a,c){if(d.options.mediaType[a]&&c){d.options.cache||(c=c+(/\?/.test(c)?"&":"?")+Math.floor(1e12*Math.random()));var e=b.createElement("source");e.setAttribute("type",d.options.mediaType[a]),e.setAttribute("src",c),d.solution.html.appendChild(e)}}),this.solution.html.load(),this.videoElem=this.solution.html,this.youtube=!1,this.updateSolution()),this.initPopcorn()):this._error("Video player not created : "+this.options.target)},initPopcorn:function(){this.killPopcorn(),this.popcorn=d(this.videoElem)},killPopcorn:function(){this.popcorn&&(this.popcorn.destroy(),delete this.popcorn)},empty:function(a){for(;a&&a.firstChild;)a.removeChild(a.firstChild)},gui_play:function(a){this._trigger(c.event.userplay,{msg:"User clicked play"}),this.play(a)},gui_pause:function(a){this._trigger(c.event.userpause,{msg:"User clicked pause"}),this.pause(a)},gui_currentTime:function(a,b){this._trigger(c.event.usercurrenttime,{msg:"User clicked the progress bar"}),this.currentTime(a,b)},play:function(a){this.youtube?this.popcorn.play(a):this.currentTime(a,!0)},pause:function(a){this.youtube?this.popcorn.pause(a):(this.videoElem.pause(),this.currentTime(a))},currentTime:function(a,b){var c=this,d=this.videoElem;if(clearTimeout(this.timeout.currentTime),this.youtube)return void this.popcorn.currentTime(a);if("number"!=typeof a||isNaN(a))b&&d.play();else{b&&this.commandsIgnored&&d.play();try{if(d.seekable&&!("object"==typeof d.seekable&&d.seekable.length>0))throw 1;d.currentTime=a,b&&d.play()}catch(e){this.timeout.currentTime=setTimeout(function(){c.currentTime(a,b)},250)}}},addEventListener:function(a,b){var c,d=this;return this.solution&&"string"==typeof a&&"function"==typeof b&&(c={html:function(a){d.youtube||b.call(this,a)},youtube:function(a){d.youtube&&b.call(d.solution.youtube,a)}},this.solution.html.addEventListener(a,c.html,!1),this.solution.youtube.addEventListener(a,c.youtube,!1),this.ytFix.push({type:a,handler:c.youtube})),c},removeEventListener:function(a,b){if(this.solution&&"string"==typeof a&&"object"==typeof b){this.solution.html.removeEventListener(a,b.html,!1),this.solution.youtube.removeEventListener(a,b.youtube,!1);for(var c=0,d=this.ytFix.length;d>c;c++)this.ytFix[c].type===a&&this.ytFix[c].handler===b.youtube&&this.ytFix.splice(c,1)}},_ytFixListeners:function(){for(var a=0,b=this.ytFix.length;b>a;a++)this.solution.youtube.addEventListener(this.ytFix[a].type,this.ytFix[a].handler,!1)}},e}(a,b,c,Popcorn),q=function(a,b,c){function d(a){if(this.options=c.extend({},{player:null,navigation:!0,fullscreen:!0,cssClass:"hyperaudio-player"},a),!this.options.player)return!1;this.status={paused:!0,currentTime:0,duration:0},this.player=this.options.player;var d=1,e=this.options.cssClass;this.wrapperElem=b.createElement("div"),this.wrapperElem.className=e+"-gui",this.controlsElem=b.createElement("ul"),this.controlsElem.className=e+"-controls",this.wrapperElem.appendChild(this.controlsElem),this.playButton=b.createElement("li"),this.playButton.className=e+"-play",this.controlsElem.appendChild(this.playButton),this.playButton.addEventListener("click",this.play.bind(this),!1),this.options.navigation&&(this.prevButton=b.createElement("li"),this.prevButton.className=e+"-prev",this.nextButton=b.createElement("li"),this.nextButton.className=e+"-next",this.controlsElem.appendChild(this.prevButton),this.controlsElem.appendChild(this.nextButton),d+=2),this.progressBarElem=b.createElement("li"),this.progressBarElem.className=e+"-bar",this.progressIndicator=b.createElement("div"),this.progressIndicator.className=e+"-progress",this.progressIndicator.style.width="0%",this.progressBarElem.appendChild(this.progressIndicator),this.controlsElem.appendChild(this.progressBarElem),this.progressBarElem.addEventListener("mousedown",this.startSeeking.bind(this),!1),this.progressBarElem.addEventListener("mousemove",this.seek.bind(this),!1),b.addEventListener("mouseup",this.stopSeeking.bind(this),!1),this.options.fullscreen&&(this.fullscreenButton=b.createElement("li"),this.fullscreenButton.className=e+"-fullscreen",this.controlsElem.appendChild(this.fullscreenButton),this.fullscreenButton.addEventListener("click",this.fullscreen.bind(this),!1),d+=1),this.currentTimeElem=b.createElement("div"),this.currentTimeElem.className=e+"-current-time",this.durationElem=b.createElement("div"),this.durationElem.className=e+"-duration",this.progressBarElem.appendChild(this.currentTimeElem),this.progressBarElem.appendChild(this.durationElem),this.progressBarElem.style.width=100-10*d+"%",c.addClass(this.player.target,e),this.player.target.appendChild(this.wrapperElem)}function e(){this.init()}function f(a){return g.time(a)}d.prototype={setStatus:function(a){c.extend(this.status,a),this.timeUpdate()},play:function(){return this.status.paused?(c.addClass(this.wrapperElem,"playing"),void this.player.gui_play()):(c.removeClass(this.wrapperElem,"playing"),void this.player.gui_pause())},timeUpdate:function(){var a=0;this.status.duration>0&&(a=Math.round(100*this.status.currentTime/this.status.duration)),this.progressIndicator.style.width=a+"%",this.currentTimeElem.innerHTML=f(this.status.currentTime),this.durationElem.innerHTML=f(this.status.duration),this.status.paused?c.removeClass(this.wrapperElem,"playing"):c.addClass(this.wrapperElem,"playing")},fullscreen:function(){return this._isFullscreen()?void this._cancelFullScreen():void this._requestFullScreen()},_requestFullScreen:function(){this.player.target.requestFullScreen?this.player.target.requestFullScreen():this.player.target.mozRequestFullScreen?this.player.target.mozRequestFullScreen():this.player.target.webkitRequestFullScreen&&this.player.target.webkitRequestFullScreen()},_cancelFullScreen:function(){b.exitFullscreen?b.exitFullscreen():b.mozCancelFullScreen?b.mozCancelFullScreen():b.webkitExitFullscreen?b.webkitExitFullscreen():b.webkitCancelFullScreen&&b.webkitCancelFullScreen()},_isFullscreen:function(){return!!(b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement||b.webkitCurrentFullScreenElement||b.msFullscreenElement)},startSeeking:function(a){this.seeking=!0,this.seek(a)},stopSeeking:function(){this.seeking&&(this.seeking=!1)},seek:function(a){if(this.seeking){var b=this.progressBarElem.getBoundingClientRect(),c=b.width,d=a.pageX-b.left,e=Math.round(100*this.status.duration*d/c)/100;this.player.gui_currentTime(e)}}},e.prototype={init:function(){this.options={timeFormat:{showHour:!1,showMin:!0,showSec:!0,padHour:!1,padMin:!0,padSec:!0,sepHour:":",sepMin:":",sepSec:""}}},time:function(a){a=a&&"number"==typeof a?a:0;var b=new Date(1e3*a),c=b.getUTCHours(),d=this.options.timeFormat.showHour?b.getUTCMinutes():b.getUTCMinutes()+60*c,e=this.options.timeFormat.showMin?b.getUTCSeconds():b.getUTCSeconds()+60*d,f=this.options.timeFormat.padHour&&10>c?"0"+c:c,g=this.options.timeFormat.padMin&&10>d?"0"+d:d,h=this.options.timeFormat.padSec&&10>e?"0"+e:e,i="";return i+=this.options.timeFormat.showHour?f+this.options.timeFormat.sepHour:"",i+=this.options.timeFormat.showMin?g+this.options.timeFormat.sepMin:"",i+=this.options.timeFormat.showSec?h+this.options.timeFormat.sepSec:""}};var g=new e;return d}(a,b,c),r=function(a,b){function c(c){this.options=b.extend({},this.options,{entity:"TRANSCRIPT",target:"#transcript",id:"",media:{},select:!0,wordsPlay:!0,group:"p",word:"a",timeAttr:"data-m",unit:.001,async:!0,stage:null,player:null},c),this.ready=!1,this.enabled=!0,this.target="string"==typeof this.options.target?a.querySelector(this.options.target):this.options.target,this.textSelect=null,this.iScrollOptions={scrollbars:!0,mouseWheel:!0,interactiveScrollbars:!0,disableMouse:!0,disablePointer:!0,disableTouch:!0},this.iScrollSpeed=800,this.iScrollOffsetY=-20,this.iScroll=new IScroll(this.target,this.iScrollOptions),this.options.DEBUG&&this._debug(),(this.options.id||this.options.media.youtube||this.options.media.mp4)&&this.load()}return c.prototype={load:function(a){var c=this;this.ready=!1,"undefined"!=typeof a&&("string"==typeof a?(this.options.id=a,this.options.media={}):"object"==typeof a?(this.options.id="",this.options.media=a):(this.options.id="",this.options.media={}));var d=function(){c.options.async?setTimeout(function(){c.setVideo()},0):c.setVideo(),setTimeout(function(){c.iScroll=new IScroll(c.target,c.iScrollOptions)},0)};this.target&&(c.iScroll.destroy(),this.target.innerHTML="",this.options.id?b.api.getTranscript(this.options.id,function(a){a?(c.target.innerHTML=this.transcript.content,c._trigger(b.event.load,{msg:'Loaded "'+c.options.id+'"'})):(c.target.innerHTML="Problem with transcript URL.",c._error(this.status+" "+this.statusText+' : "'+c.options.id+'"')),d()}):this.options.media.transcript&&b.xhr({url:this.options.media.transcript,complete:function(){c.target.innerHTML=this.responseText,c._trigger(b.event.load,{msg:'Loaded "'+c.options.src+'"'}),d()},error:function(){c.target.innerHTML="Problem with transcript URL.",c._error(this.status+" "+this.statusText+' : "'+c.options.src+'"'),d()}}))},setVideo:function(){var a=this;if(this.options.player){if(this.options.id&&b.api.transcript){var c=b.api.transcript.media;if(this.options.media={id:c?c._id:""},c&&c.source)for(var d in c.source)this.options.media[d]=c.source[d].url}this.options.player.load(this.options.media),this.options.async?setTimeout(function(){a.parse()},0):this.parse()}else this._error("Player not defined"),this.selectorize()},parse:function(){var a=this,c=this.options;if(this.target&&c.player&&c.player.popcorn){var d,e=this.target.querySelectorAll(c.target+" "+c.word),f=e.length,g=function(b){a.iScroll.scrollToElement(b,a.iScrollSpeed,null,a.iScrollOffsetY)};for(d=0;f>d;d++)c.player.popcorn.transcript({time:e[d].getAttribute(c.timeAttr)*c.unit,futureClass:"transcript-grey",target:e[d],onNewPara:g});this.target.addEventListener("click",function(d){if(d.preventDefault(),d.target.nodeName.toLowerCase()===c.word){var e=d.target.getAttribute(c.timeAttr),f=e*c.unit;c.wordsPlay?c.player.play(f):c.player.currentTime(f),a._trigger(b.event.userplayword,{msg:"User clicked on a word to play from"})}},!1)}this.selectorize()},selectorize:function(){var a=this,c=this.options;c.select&&(this.deselectorize(),this.textSelect=new b.WordSelect({el:c.target,onDragStart:function(d){if(c.stage){b.addClass(c.stage.target,c.stage.options.dragdropClass);var e=new b.DragDrop({dropArea:c.stage.target,init:!1,onDrop:function(d){b.removeClass(c.stage.target,c.stage.options.dragdropClass),this.destroy(),d&&(a.textSelect.clearSelection(),c.media.id&&d.setAttribute(c.stage.options.idAttr,c.media.id),c.media.transcript&&d.setAttribute(c.stage.options.transAttr,c.media.transcript),c.media.mp4&&d.setAttribute(c.stage.options.mp4Attr,c.media.mp4),c.media.webm&&d.setAttribute(c.stage.options.webmAttr,c.media.webm),c.media.youtube&&d.setAttribute(c.stage.options.ytAttr,c.media.youtube),d.setAttribute(c.stage.options.unitAttr,c.unit),c.stage.dropped(d))}}),f=this.getSelection().replace(/ class="[\d\w\s\-]*\s?"/gi,"")+'<div class="actions"></div>';e.init(f,d)}},onSelection:function(){b.Clipboard&&b.Clipboard.copy(a.getSelection().text)},onClear:function(){b.Clipboard&&b.Clipboard.clear()}}),this.ready=!0,this._trigger(b.event.ready,{msg:"Transcript is ready."}))},deselectorize:function(){this.textSelect&&this.textSelect.destroy(),delete this.textSelect},getSelection:function(){if(this.textSelect){var b,c,d,e,f=this.options,g=this.textSelect.getSelection(),h=a.createElement("div");return h.innerHTML=g,b=h.querySelectorAll(f.word),b.length&&(c=b[0].getAttribute(f.timeAttr),d=b[b.length-1].getAttribute(f.timeAttr)),e=h.textContent,e.trim&&(e=e.trim()),{text:e,start:c,end:d}}return{}},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}},c}(b,c),s=function(a,b){function c(c){var d=this;this.options=b.extend({},this.options,{entity:"STAGE",target:"#stage",id:"",mix:{},title:"Title not set",desc:"Description not set",type:"beta",editable:!0,idAttr:"data-id",transAttr:"data-trans",mp4Attr:"data-mp4",webmAttr:"data-webm",ytAttr:"data-yt",unitAttr:"data-unit",word:"a",section:"section",dragdropClass:"dragdrop",async:!0,projector:null},c),this.ready=!1,this.enabled=!0,this.target="string"==typeof this.options.target?a.querySelector(this.options.target):this.options.target,this.article=a.createElement("article"),this.mix={},this.target.appendChild(this.article),this.target.addEventListener("change",function(){d.changed()},!1),this.target.addEventListener("click",function(a){var b,c,e;if(a.target.nodeName.toLowerCase()===d.options.word){for(c=a.target,e=c;e;){if(e.nodeName.toLowerCase()===d.options.section){b=e;break}e=e.parentNode}d.options.projector&&d.options.projector.playWord(b,c)}},!1),this.options.DEBUG&&this._debug(),this.options.projector&&this.options.projector.setStage(this),(this.options.id||this.options.mix.url||this.options.mix.content)&&this.load()}return c.prototype={mixDetails:function(a){b.extend(this.options,a)},updateStage:function(b){var c=a.createElement("div");c.innerHTML=b;var d=c.querySelector("article");this.article.innerHTML=d.innerHTML;for(var e=d.attributes,f=0,g=e.length;g>f;f++)this.article.setAttribute(e[f].name,e[f].value)},load:function(a){var c=this;"undefined"!=typeof a&&("string"==typeof a?(this.options.id=a,this.options.mix={}):"object"==typeof a?(this.options.id="",this.options.mix=a):(this.options.id="",this.options.mix={})),this.target&&(this.options.id?b.api.getMix(a,function(d){d?(c.mix=b.extend({},this.mix),c.mixDetails({title:c.mix.label,desc:c.mix.desc,type:c.mix.type}),c.updateStage(c.mix.content),c.initDragDrop(),c._trigger(b.event.load,{msg:"Loaded mix"})):c._error(this.status+" "+this.statusText+' : "'+a+'"')}):(this.mixDetails({title:this.options.mix.title,desc:this.options.mix.desc,type:this.options.mix.type}),this.options.mix.url?b.xhr({url:this.options.mix.url,complete:function(){c.updateStage(this.responseText),c.initDragDrop(),c._trigger(b.event.load,{msg:'Loaded "'+c.options.mix.url+'"'})},error:function(){c.target.innerHTML="Problem with mix URL.",c._error(this.status+" "+this.statusText+' : "'+c.options.mix.url+'"')}}):this.options.mix.content?(this.updateStage(this.options.mix.content),this.initDragDrop(),this._trigger(b.event.load,{msg:"Loaded given content"})):(this.target.innerHTML="Problem with mix.",this._error("Stage : No ID, URL or Content"))))},save:function(a){var c=this;b.extend(this.mix,{label:this.options.title,desc:this.options.desc,type:this.options.type,content:this.target.innerHTML}),this.target&&b.api.putMix(this.mix,function(d){d?d.saved?(c.mix=b.extend({},this.mix),b.Address.setParam("m",c.mix._id),c._trigger(b.event.save,{msg:"Saved mix"})):d.needLogin?c._trigger(b.event.unauthenticated,{msg:"Sign In required to save"}):c._error("Stage: Save: Error with API putMix() response"):c._error("Stage: Save: Error with API putMix() request"),c.callback(a,d)})},callback:function(a,b){"function"==typeof a&&a.call(this,b)},clear:function(){this.article.innerHTML="",this.mix={},this.options.id="",this.changed(!0),b.Address.setParam("m")},parse:function(){this.options},initDragDrop:function(){var a,b,c,d,e,f=this,g=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};if(this.options.editable){if(this.target)for(c=this.target.getElementsByTagName("section"),b=c.length,a=0;b>a;a++){if(e="",d=c[a].getAttribute("data-effect"),"string"==typeof d)switch(d){case"fade":case"trim":case"title":e=g(d);break;case"bgm":bgmTitleElem=c[a].querySelector(".icon-music"),e=bgmTitleElem?bgmTitleElem.parentNode.innerHTML:'<span class="icon-music">BGM</span>'}f.dropped(c[a],e)}}else this.changed()},dropped:function(a,c){var f,g=this,i="",j=function(a){a.stopPropagation(),this.parentNode._editBlock=new e({el:this.parentNode,stage:g})};this.target&&(/(^|\s)effect($|\s)/.test(a.className)?i="draggableEffect":(f=a.querySelector(".actions"),f&&(f._tap=new h({el:f}),f.addEventListener("tap",j,!1))),a._dragInstance=new d({handle:a,dropArea:this.target,html:c?c:a.innerHTML,draggableClass:i,onDragStart:function(){b.addClass(g.target,g.options.dragdropClass)},onDrop:function(){b.removeClass(g.target,g.options.dragdropClass),g.changed()}}),this.changed())},changed:function(a){this.options.projector&&this.options.projector.requestUpdate(a),this._trigger(b.event.change,{msg:"The mix has changed"})},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}},c}(b,c),t=function(a,b,c){function d(a){this.options=c.extend({},this.options,{entity:"PROJECTOR",target:"#transcript-video",trim:1,players:2,unit:.001,stageChangeDelay:1e3,timeAttr:"data-m",music:null,gui:!0,async:!0},a),this.target="string"==typeof this.options.target?b.querySelector(this.options.target):this.options.target,this.stage=null,this.timeout={},this.player=[],this.activePlayer=0,this.nextPlayer=this.options.players>1?1:0,this.updateRequired=!1,this.stageArticle=null,this.stageSections=null,this.stageIndex=0,this.content=[],this.contentIndex=0,this.firstContent=!0,this.endedContent=!1,this.isReadyToPlay=!1,this.needsInitVideo=!0,this.paused=!0,this.time={},this.iScrollOptions={scrollbars:!0,mouseWheel:!0,interactiveScrollbars:!0,disableMouse:!0,disablePointer:!0,disableTouch:!0},this.iScrollSpeed=800,this.iScrollOffsetY=-20,this.iScroll=null,this.options.DEBUG&&this._debug(),this.target&&this.create()}var e=!1;return d.prototype={setStage:function(a){this.stage=a,this.iScroll=new IScroll(this.stage.target,this.iScrollOptions)},create:function(){var a=this;if(this.target){for(var d=function(b){return function(c){a.activePlayer===b&&a.manager(this,c)}},e=0;e<this.options.players;e++){var f=d(e),g=b.createElement("div");c.addClass(g,"hyperaudio-projector"),this.player[e]=c.Player({target:g}),this.player[e].addEventListener("progress",f),this.player[e].addEventListener("timeupdate",f),this.player[e].addEventListener("play",f),this.player[e].addEventListener("pause",f),this.player[e].addEventListener("ended",f),this.target.appendChild(g)}this.addHelpers(),this.options.gui&&(this.GUI=new c.PlayerGUI({player:this,navigation:!1,fullscreen:!0,cssClass:this.player[0].options.cssClass}))}else this._error("Target not found : "+this.options.target)},addHelpers:function(){var a=b.createElement("div");a.id="fxHelper",a.className="video-transition-servo",a.appendChild(b.createElement("div"));var c=b.createElement("div");c.id="titleFXHelper",c.className="title-effect-servo",this.target.appendChild(a),this.target.appendChild(c)},initPopcorn:function(a,b){var c,d,f,g=this,h=function(a){g.iScroll.scrollToElement(a,g.iScrollSpeed,null,g.iScrollOffsetY)};if(a<this.content.length&&b<this.player.length)for(this.player[b].initPopcorn(),e&&console.log("[Projector|initPopcorn] player[%d].initPopcorn()",b),c=this.content[a].element.getElementsByTagName("a"),d=0,f=c.length;f>d;d++)this.player[b].popcorn.transcript({time:c[d].getAttribute(this.options.timeAttr)*this.content[a].unit,futureClass:"transcript-grey",target:c[d],onNewPara:h})},load:function(a){var b=this.content[a].media,d=this.which(b);this.contentIndex=a,d!==!1?this.activePlayer=d:(this.player[this.activePlayer].load(b),e&&console.log("[Projector|load] player[%d].load() | initPopcorn()",this.activePlayer)),this.initPopcorn(a,this.activePlayer);for(var f=0;f<this.player.length;f++)c.removeClass(this.player[f].target,"active");c.addClass(this.player[this.activePlayer].target,"active"),e&&console.log("[Projector|load] contentIndex: %d | activePlayer: %d",this.contentIndex,this.activePlayer)},prepare:function(a){var b=this.content[a].media;if(b&&this.player.length>1){var c=this.which(b),d=Math.max(0,this.content[a].start-1);c===!1?(this.nextPlayer=this.activePlayer+1<this.player.length?this.activePlayer+1:0,this.player[this.nextPlayer]&&(this.player[this.nextPlayer].load(b),this.player[this.nextPlayer].pause(d),e&&console.log("[Projector|prepare] player[%d].load() | initPopcorn()",this.nextPlayer),e&&console.log("[Projector|prepare] prepared=false | nextPlayer: %d | alignStart: %d",this.nextPlayer,d))):c!==this.activePlayer&&(this.player[c].initPopcorn(),this.player[c].pause(d),e&&console.log("[Projector|prepare] player[%d].initPopcorn()",c),e&&console.log("[Projector|prepare] prepared="+c+" | nextPlayer: %d | alignStart: %d",this.nextPlayer,d))}},which:function(a){var b=!1;if(a)for(var c=0;c<this.player.length;c++)if(!this.player[c].mediaDiff(a)){b=c;break}return e&&console.log("[Projector|which] media: %o | index: "+b,a),b},cue:function(a,b){var d,f,g,h,i;if(this.stage&&this.stage.target&&(this.updateRequired&&this.updateContent(),this._pause(),this.contentIndex=b.contentIndex,this.options.music&&this.options.music.pause(),this.contentIndex<this.content.length)){for(this.load(this.contentIndex),this.content[this.contentIndex+1]&&this.prepare(this.contentIndex+1),this.resetEffects(b),this.options.gui&&this.GUI.setStatus({currentTime:this.getTotalCurrentTime(b.start,b.contentIndex)}),d=0,f=this.content.length;f>d;d++)for(g=this.content[d].element.getElementsByTagName("a"),h=0,i=g.length;i>h;h++)d<this.contentIndex?c.removeClass(g[h],"transcript-grey"):d>this.contentIndex&&c.addClass(g[h],"transcript-grey");this.isReadyToPlay=!0,e&&console.log("[Projector|cue] isReadyToPlay = "+this.isReadyToPlay),a?this._play(b.start):this._pause(b.start)}},gui_play:function(a){this._trigger(c.event.userplay,{msg:"User clicked play"}),this.play(a)},gui_pause:function(a){this._trigger(c.event.userpause,{msg:"User clicked pause"}),this.pause(a)},gui_currentTime:function(a,b){this._trigger(c.event.usercurrenttime,{msg:"User clicked the progress bar"}),this.currentTime(a,b)},play:function(){var a,b=!1;arguments.length&&"undefined"!=typeof arguments[0]?"object"==typeof arguments[0]&&(a=arguments[0],e&&console.log("[Projector|play] jumpTo =  %o",a)):this.isReadyToPlay&&(b=!0),e&&console.log("[Projector|play] resume = "+b+" | content.length = %d | arguments = %o",this.content.length,arguments),this.content.length?b?this._play():a?(this._pause(),this.cue(!0,{contentIndex:a.contentIndex,start:a.start})):(this.cue(!0,{contentIndex:0,start:this.content[0].start}),this.effect(this.content[0].effect)):this.options.gui&&this.GUI.setStatus({paused:this.paused})},pause:function(){this._pause(),this.options.music&&this.options.music.pause()},_play:function(a){this.paused=!1,this.player[this.activePlayer].play(a)},_pause:function(a){this.paused=!0,this.player[this.activePlayer].pause(a)},currentTime:function(a){var b,c,d={};if(this.stage&&this.stage.target)for(this.updateRequired&&this.updateContent(),b=0,c=this.content.length;c>b;b++)if(this.content[b].totalStart<=a&&a<this.content[b].totalEnd){d.contentIndex=b,d.start=a-this.content[b].totalStart+this.content[b].start,this.cue(!this.paused,d);break}},playWord:function(a,b){var d,e,f={};if(this.stage&&this.stage.target)for(this.updateRequired&&this.updateContent(),d=0,e=this.content.length;e>d;d++)if(this.content[d].element===a){f.contentIndex=d,f.start=b.getAttribute(this.options.timeAttr)*this.content[d].unit,this._trigger(c.event.userplayword,{msg:"User clicked on a word to play from"}),this.play(f);break}},requestUpdate:function(a){var b=this,c=this.options.stageChangeDelay;a&&(this.pause(),this.options.gui&&this.GUI.setStatus({paused:this.paused,currentTime:0,duration:0}),this.needsInitVideo=!0,c=0),this.updateRequired=!0,clearTimeout(this.timeout.updateContent),this.timeout.updateContent=setTimeout(function(){b.updateContent()},c)},updateContent:function(){var a,b,c=0;if(this.updateRequired=!1,clearTimeout(this.timeout.updateContent),this.isReadyToPlay=!1,e&&console.log("[Projector|updateContent#1] isReadyToPlay = "+this.isReadyToPlay),this.stage&&this.stage.target){for(this.iScroll.refresh(),this.stageArticle=this.stage.target.getElementsByTagName("article")[0],this.stageSections=this.stageArticle.getElementsByTagName("section"),this.stageIndex=0,this.content=[],this.firstContent=!0,this.endedContent=!1;!this.endedContent;)this.getContent();for(a=0,b=this.content.length;b>a;a++)this.content[a].totalStart=c,c+=this.content[a].end+this.content[a].trim-this.content[a].start,this.content[a].totalEnd=c;this.time.duration=c,this.options.gui&&this.GUI.setStatus({duration:this.time.duration}),this.needsInitVideo&&this.content.length&&(this.needsInitVideo=!1,this.cue(!1,{contentIndex:0,start:this.content[0].start}),this.isReadyToPlay=!1,e&&console.log("[Projector|updateContent#2] isReadyToPlay = "+this.isReadyToPlay))}},getContent:function(){for(var a,b=[],d=!0;d;){if(a=this.getSection(this.stageIndex))if(a.media)a.effect=[],this.effectContent(a,b),this.content.push(a),this.firstContent?(this.firstContent=!1,b=[]):d=!1;else if(a.effect)if("trim"===a.effect.type)this.content.length&&this.effectContent(this.content[this.content.length-1],a.effect);else if("fade"===a.effect.type){var e=c.extend({},a.effect,{type:"fadeOut"}),f=c.extend({},a.effect,{type:"fadeIn"});this.content.length&&this.effectContent(this.content[this.content.length-1],e),b.push(f)}else if("title"===a.effect.type&&a.effect.fullscreen){var g=c.extend({},a.effect,{type:"fadeOut",duration:1}),h=c.extend({},a.effect,{type:"fadeIn",duration:1,delay:a.effect.duration});this.content.length?this.effectContent(this.content[this.content.length-1],g):(g.type="fadeNow",b.push(g)),b.push(h)}else b.push(a.effect);else d=!1;else this.endedContent=!0,d=!1;this.stageIndex++}},getSection:function(a){var b=this.stage?this.stage.options:{},c={index:a};if(a<this.stageSections.length){var d=c.element=this.stageSections[a];c.id=d.getAttribute(b.idAttr);var e=d.getAttribute(b.mp4Attr),f=d.getAttribute(b.webmAttr),g=d.getAttribute(b.ytAttr);c.media=e||f||g?{mp4:e,webm:f,youtube:g}:!1;var h=1*d.getAttribute(b.unitAttr);c.unit=h=h>0?h:this.options.unit;var i=d.getElementsByTagName("a");return i.length&&(c.start=i[0].getAttribute(this.options.timeAttr)*h,c.end=i[i.length-1].getAttribute(this.options.timeAttr)*h,c.trim=this.options.trim),c.effect=this.getSectionEffect(d),c}return!1},getSectionEffect:function(a){var b,c,d,e=a.getAttribute("data-effect");return e?(d={title:a.querySelector("#effect-title"),fullscreen:a.querySelector("#effect-fullscreen"),delay:a.querySelector("#effect-delay"),start:a.querySelector("#effect-start"),duration:a.querySelector("#effect-duration"),volume:a.querySelector("#effect-volume")},c={mp3:a.getAttribute("data-mp3"),mp4:a.getAttribute("data-mp4"),ogg:a.getAttribute("data-ogg")},b={type:e,title:d.title?d.title.value:"",fullscreen:d.fullscreen?d.fullscreen.checked:!1,delay:d.delay?1*d.delay.value:0,start:d.start?1*d.start.value:0,duration:d.duration?1*d.duration.value:0,volume:d.volume?d.volume.value/100:0,media:c}):b=!1,b},bgmFX:function(a){this.options.music&&this.options.music.bgmFX(a)},isPrevEffect:function(a){var b="trim",d=!1;return c.each(b.split(/\s+/g),function(b,c){return a.type===c?(d=!0,!1):void 0}),d},isPrevAndNextEffect:function(a){var b="fade",d=!1;return c.each(b.split(/\s+/g),function(b,c){return a.type===c?(d=!0,!1):void 0}),d},effectContent:function(a,b){b&&!b.length&&0!==b.length&&(b=[b]);for(var c=0,d=b.length;d>c;c++)switch(b[c].type){case"title":a.effect.push(b[c]);break;case"fadeOut":a.effect.push(b[c]);break;case"fadeIn":a.effect.push(b[c]);break;case"fadeNow":a.effect.push(b[c]);break;case"bgm":a.effect.push(b[c]);break;case"trim":a.trim=b[c].duration}},resetEffects:function(a){var b,c,d,e,g;for(b=0,c=this.content.length;c>b;b++)for(g=this.content[b].effect,d=0,e=g.length;e>d;d++)g[d].init=b<a.contentIndex?!0:b>a.contentIndex?!1:"fadeOut"===g[d].type?!1:this.content[b].start+g[d].delay<a.start?!0:!1;f({el:"#fxHelper",fadeIn:!0,time:0})},effect:function(a,b){if(b="number"==typeof b?b:0,a&&a.length)for(var c=0,d=a.length;d>c;c++)if(!a[c].init&&a[c].delay<=b)switch(a[c].type){case"title":a[c].title&&a[c].duration&&(i({el:"#titleFXHelper",text:a[c].title,duration:1e3*a[c].duration}),a[c].init=!0);break;case"fadeIn":a[c].duration&&(f({el:"#fxHelper",fadeIn:!0,text:a[c].title,time:1e3*a[c].duration}),a[c].init=!0);break;case"fadeNow":f({el:"#fxHelper",fadeOut:!0,text:a[c].title,time:0}),a[c].init=!0;break;case"bgm":a[c].duration&&(this.bgmFX({media:{mp3:a[c].media.mp3,mp4:a[c].media.mp4,ogg:a[c].media.ogg},delay:a[c].delay,start:a[c].start,duration:a[c].duration,volume:a[c].volume}),a[c].init=!0)}},effectEnd:function(a){if(a&&a.length)for(var b=0,c=a.length;c>b;b++)if(!a[b].init)switch(a[b].type){case"fadeOut":a[b].duration&&(f({el:"#fxHelper",fadeOut:!0,text:a[b].title,time:1e3*a[b].duration}),a[b].init=!0)}},checkEndEffects:function(a,b){for(var c=this.getEndEffects(b),d=c.length,e=0;d>e;e++)c[e].init||a>b.end+b.trim-c[e].duration&&this.effectEnd([c[e]])},getEndEffects:function(a){var b="fadeOut",d=[];return c.each(a.effect,function(a,e){c.each(b.split(/\s+/g),function(a,b){e.type===b&&d.push(e)})}),d},getTotalCurrentTime:function(a,b){var c,d,e=0;return b<this.content.length&&(c=this.content[b].start,d=this.content[b].end+this.content[b].trim,e=this.content[b].totalStart,a>c&&d>a?e+=a-c:a>=d&&(e=this.content[b].totalEnd)),e},manager:function(a){if(this.paused=a.paused,this.paused)this.options.gui&&this.GUI.setStatus({paused:this.paused});else{this.checkEndEffects(a.currentTime,this.content[this.contentIndex]);var b=this.content[this.contentIndex].end+this.content[this.contentIndex].trim,c=this.getTotalCurrentTime(a.currentTime,this.contentIndex),d=a.currentTime-this.content[this.contentIndex].start;a.currentTime>b?(this.effect(this.content[this.contentIndex].effect,1/0),this._pause(),this.contentIndex++,this.contentIndex<this.content.length?(this.load(this.contentIndex),this.content[this.contentIndex+1]&&this.prepare(this.contentIndex+1),this.effect(this.content[this.contentIndex].effect,0),this._play(this.content[this.contentIndex].start)):(this.paused=!0,this.isReadyToPlay=!1,e&&console.log("[Projector|manager] isReadyToPlay = "+this.isReadyToPlay),this.contentIndex=0,this.prepare(this.contentIndex),this.options.music&&this.options.music.pause())):this.effect(this.content[this.contentIndex].effect,d),this.options.gui&&this.GUI.setStatus({paused:this.paused,currentTime:c})}}},d}(a,b,c,Popcorn);return c.register("Music",o),c.register("Player",p),c.register("PlayerGUI",q),c.register("Transcript",r),c.register("Stage",s),c.register("Projector",t),c.utility("Address",n),c.utility("api",l),c.utility("Clipboard",m),c.utility("DragDrop",d),c.utility("EditBlock",e),c.utility("fadeFX",f),c.utility("SideMenu",g),c.utility("Tap",h),c.utility("titleFX",i),c.utility("WordSelect",j),c.utility("xhr",k),c}(window,document);